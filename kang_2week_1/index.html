<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>#2 K8S - Kubernetes &#8211; lahuman</title> <meta name="description" content="열심히 사는 아저씨"> <meta name="keywords" content="kang, network, kubernetes"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://lahuman.github.io/assets/img/logo.png"> <meta name="twitter:title" content="#2 K8S - Kubernetes"> <meta name="twitter:description" content="Kubernetes Advanced Networking Study"> <!-- Open Graph --> <meta property="og:locale" content="ko_KR"> <meta property="og:type" content="article"> <meta property="og:title" content="#2 K8S - Kubernetes"> <meta property="og:description" content="Kubernetes Advanced Networking Study"> <meta property="og:url" content="https://lahuman.github.io/kang_2week_1/"> <meta property="og:site_name" content="lahuman"> <meta property="og:image" content="https://lahuman.github.io/assets/img/logo.png"> <link rel="canonical" href="https://lahuman.github.io/kang_2week_1/"> <link href="https://lahuman.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="lahuman Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://lahuman.github.io/assets/css/main.css"> <!-- JS --> <script src="https://lahuman.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://lahuman.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://lahuman.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://lahuman.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://lahuman.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://lahuman.github.io/favicon.png" /> <link rel="shortcut icon" href="https://lahuman.github.io/favicon.ico" /> <!-- mermaid --> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script>mermaid.initialize({startOnLoad:true});</script> <!-- Background Image --> <style type="text/css">body {background-image:url(https://lahuman.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://lahuman.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://lahuman.github.io/assets/img/logo.png" alt="lahuman photo" class="author-photo"> <h4>lahuman</h4> <p>열심히 사는 아저씨</p> </li> <li><a href="https://lahuman.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://facebook.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://linkedin.com/in/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://lahuman.github.io/posts/">All Posts</a></li> <li><a href="https://lahuman.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://lahuman.github.io/projects/" >Projects</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>#2 K8S - Kubernetes</h1> <h4>18 Jan 2022</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~11 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://lahuman.github.io/projects/"> <i class="fa fa-chevron-left"></i> </a> </div> <h1 id="k8s---kubernetes">K8S - Kubernetes</h1> <blockquote> <p>KANG 2주차 내용을 따라하면서 정리하였습니다. 매주 매우 광범위한 자료를 제공해주시고 이를 한번에 정리하기 보다는 여러편으로 나누어서 정리 하고 있습니다. 안타깝게도, 제가 한번 소화 하여 정리 하려고 노력은 하고 있지만 대부분의 내용을 그대로 옮기는 수준이네요.</p> </blockquote> <h2 id="2주-내용-요약">2주 내용 요약</h2> <ul> <li>다수의 컨테이너를 운영해야 될 때 발생하는 도커의 부족한 점을 해결하기 위해 컨테이너 오케스트레이션이 나오게 되었습니다.</li> <li>현재 컨테이너 오케스트레이션 중 가장 유명한 도구는 쿠버네티스 입니다.</li> <li>쿠버네티스는 컨트롤 플레인(마스터)와 노드(워커)로 구성되어 있습니다.</li> <li>쿠버네티스는 컨테이너 애플리케이션의 기본 단위를 파드(Pod)라고 부르며, 파드는 1개 이상의 컨테이너로 구성된 컨테이너의 집합입니다.</li> </ul> <h2 id="실습-환경-구성">실습 환경 구성</h2> <p>3개의 VM을 생성하며, 컨트롤 플레인 1개와 워커 2개로 구성합니다. PC 사양에 따라 cpu, memory를 다르게 설정하세요</p> <blockquote> <p>K8S 버전은 1.22.5, CNI 는 flannel(v0.16.1, 가장 이해하기 쉬운 구조)로 설정되어 있습니다.</p> </blockquote> <h3 id="vagrantfile">Vagrantfile</h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Base Image</span>
<span class="no">BOX_IMAGE</span> <span class="o">=</span> <span class="s2">"ubuntu/focal64"</span>
<span class="no">BOX_VERSION</span> <span class="o">=</span> <span class="s2">"20211026.0.0"</span>

<span class="c1"># 워커 노드 수</span>
<span class="no">N</span> <span class="o">=</span> <span class="mi">2</span>

<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
<span class="c1">#-----Manager Node</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"k8s-m"</span> <span class="k">do</span> <span class="o">|</span><span class="n">subconfig</span><span class="o">|</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">boot_timeout</span> <span class="o">=</span> <span class="mi">1800</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="no">BOX_IMAGE</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_version</span> <span class="o">=</span> <span class="no">BOX_VERSION</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">customize</span> <span class="p">[</span><span class="s2">"modifyvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"--groups"</span><span class="p">,</span> <span class="s2">"/Flannel-Lab"</span><span class="p">]</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">customize</span> <span class="p">[</span> <span class="s2">"modifyvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"--uartmode1"</span><span class="p">,</span> <span class="s2">"disconnected"</span> <span class="p">]</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"Flannel-k8s-m"</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">6048</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">linked_clone</span> <span class="o">=</span> <span class="kp">true</span>
      <span class="k">end</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">hostname</span> <span class="o">=</span> <span class="s2">"k8s-m"</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"./"</span><span class="p">,</span> <span class="s2">"/vagrant"</span><span class="p">,</span> <span class="ss">disabled: </span><span class="kp">true</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.100.10"</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">22</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">50010</span><span class="p">,</span> <span class="ss">auto_correct: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">id: </span><span class="s2">"ssh"</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"https://raw.githubusercontent.com/gasida/KANS/main/2/init_cfg.sh"</span><span class="p">,</span> <span class="ss">args: </span><span class="no">N</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"https://raw.githubusercontent.com/gasida/KANS/main/2/master.sh"</span>
    <span class="k">end</span>

<span class="c1">#-----Worker Node</span>
  <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="no">N</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"k8s-w</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span> <span class="k">do</span> <span class="o">|</span><span class="n">subconfig</span><span class="o">|</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">boot_timeout</span> <span class="o">=</span> <span class="mi">1800</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="no">BOX_IMAGE</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_version</span> <span class="o">=</span> <span class="no">BOX_VERSION</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">customize</span> <span class="p">[</span><span class="s2">"modifyvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"--groups"</span><span class="p">,</span> <span class="s2">"/Flannel-Lab"</span><span class="p">]</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">customize</span> <span class="p">[</span> <span class="s2">"modifyvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"--uartmode1"</span><span class="p">,</span> <span class="s2">"disconnected"</span> <span class="p">]</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"Flannel-k8s-w</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">2536</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">v</span><span class="p">.</span><span class="nf">linked_clone</span> <span class="o">=</span> <span class="kp">true</span>
      <span class="k">end</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">hostname</span> <span class="o">=</span> <span class="s2">"k8s-w</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"./"</span><span class="p">,</span> <span class="s2">"/vagrant"</span><span class="p">,</span> <span class="ss">disabled: </span><span class="kp">true</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.100.10</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">22</span><span class="p">,</span> <span class="ss">host: </span><span class="s2">"5001</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="ss">auto_correct: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">id: </span><span class="s2">"ssh"</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"https://raw.githubusercontent.com/gasida/KANS/main/2/init_cfg.sh"</span><span class="p">,</span> <span class="ss">args: </span><span class="no">N</span>
      <span class="n">subconfig</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"https://raw.githubusercontent.com/gasida/KANS/main/2/worker.sh"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="init_cfgsh--공통-설정script-부분">init_cfg.sh : 공통 설정(script) 부분</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>

<span class="c"># root password</span>
<span class="nb">echo</span> <span class="s2">"&gt;&gt;&gt;&gt; root password &lt;&lt;&lt;&lt;&lt;&lt;"</span>
<span class="nb">printf</span> <span class="s2">"qwe123</span><span class="se">\n</span><span class="s2">qwe123</span><span class="se">\n</span><span class="s2">"</span> | passwd

<span class="c"># config sshd</span>
<span class="nb">echo</span> <span class="s2">"&gt;&gt;&gt;&gt; ssh-config &lt;&lt;&lt;&lt;&lt;&lt;"</span>
sed <span class="nt">-i</span> <span class="s2">"s/^PasswordAuthentication no/PasswordAuthentication yes/g"</span> /etc/ssh/sshd_config
sed <span class="nt">-i</span> <span class="s2">"s/^#PermitRootLogin prohibit-password/PermitRootLogin yes/g"</span> /etc/ssh/sshd_config
systemctl restart sshd

<span class="c"># profile bashrc settting</span>
<span class="nb">echo</span> <span class="s1">'alias vi=vim'</span> <span class="o">&gt;&gt;</span> /etc/profile
<span class="nb">echo</span> <span class="s2">"sudo su -"</span> <span class="o">&gt;&gt;</span> .bashrc

<span class="c"># Letting iptables see bridged traffic</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt;  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
</span><span class="no">EOF
</span>sysctl <span class="nt">--system</span>

<span class="c"># local dns setting</span>
<span class="nb">echo</span> <span class="s2">"192.168.100.10 k8s-m"</span> <span class="o">&gt;&gt;</span> /etc/hosts
<span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span>1<span class="p">;</span> i&lt;<span class="o">=</span><span class="nv">$1</span><span class="p">;</span> i++  <span class="o">))</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"192.168.100.10</span><span class="nv">$i</span><span class="s2"> k8s-w</span><span class="nv">$i</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /etc/hosts<span class="p">;</span> <span class="k">done</span>

<span class="c"># apparmor disable</span>
systemctl stop apparmor <span class="o">&amp;&amp;</span> systemctl disable apparmor

<span class="c"># package install</span>
apt update
apt-get install bridge-utils net-tools jq tree resolvconf wireguard <span class="nt">-y</span>

<span class="c"># config dnsserver ip</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"nameserver 1.1.1.1"</span> <span class="o">&gt;</span> /etc/resolvconf/resolv.conf.d/head
resolvconf <span class="nt">-u</span>

<span class="c"># docker install</span>
curl <span class="nt">-fsSL</span> https://get.docker.com | sh

<span class="c"># Cgroup Driver systemd</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | tee /etc/docker/daemon.json
{"exec-opts": ["native.cgroupdriver=systemd"]}
</span><span class="no">EOF
</span>systemctl daemon-reload <span class="o">&amp;&amp;</span> systemctl restart docker

<span class="c"># swap off</span>
swapoff <span class="nt">-a</span>

<span class="c"># Installing kubeadm kubelet and kubectl</span>
curl <span class="nt">-fsSLo</span> /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
<span class="nb">echo</span> <span class="s2">"deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main"</span> | <span class="nb">sudo </span>tee /etc/apt/sources.list.d/kubernetes.list
apt-get update
<span class="c">#apt-get install -y kubelet kubeadm kubectl</span>
<span class="c">#apt-get install -y kubelet=&lt;VERSION&gt; kubectl=&lt;VERSION&gt; kubeadm=&lt;VERSION&gt;</span>
apt-get install <span class="nt">-y</span> <span class="nv">kubelet</span><span class="o">=</span>1.22.5-00 <span class="nv">kubectl</span><span class="o">=</span>1.22.5-00 <span class="nv">kubeadm</span><span class="o">=</span>1.22.5-00
apt-mark hold kubelet kubeadm kubectl
systemctl <span class="nb">enable </span>kubelet <span class="o">&amp;&amp;</span> systemctl start kubelet
</code></pre></div></div> <h3 id="mastersh--마스터-노드-설정script-파일">master.sh : 마스터 노드 설정(script) 파일</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>

<span class="c"># init kubernetes </span>
kubeadm init <span class="nt">--token</span> 123456.1234567890123456 <span class="nt">--token-ttl</span> 0 <span class="nt">--pod-network-cidr</span><span class="o">=</span>172.16.0.0/16 <span class="nt">--apiserver-advertise-address</span><span class="o">=</span>192.168.100.10

<span class="c"># config for master node only </span>
mkdir <span class="nt">-p</span> <span class="nv">$HOME</span>/.kube
cp <span class="nt">-i</span> /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
chown <span class="k">$(</span>id <span class="nt">-u</span><span class="k">)</span>:<span class="k">$(</span>id <span class="nt">-g</span><span class="k">)</span> <span class="nv">$HOME</span>/.kube/config

<span class="c"># flannel install</span>
kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/gasida/KANS/main/2/kube-flannel.yml

<span class="c"># etcdctl install</span>
apt install etcd-client <span class="nt">-y</span>

<span class="c"># source bash-completion for kubectl kubeadm</span>
<span class="nb">source</span> &lt;<span class="o">(</span>kubectl completion bash<span class="o">)</span>
<span class="nb">source</span> &lt;<span class="o">(</span>kubeadm completion bash<span class="o">)</span>

<span class="c">## Source the completion script in your ~/.bashrc file</span>
<span class="nb">echo</span> <span class="s1">'source &lt;(kubectl completion bash)'</span> <span class="o">&gt;&gt;</span> /etc/profile
<span class="nb">echo</span> <span class="s1">'source &lt;(kubeadm completion bash)'</span> <span class="o">&gt;&gt;</span> /etc/profile

<span class="c">## alias kubectl to k </span>
<span class="nb">echo</span> <span class="s1">'alias k=kubectl'</span> <span class="o">&gt;&gt;</span> /etc/profile
<span class="nb">echo</span> <span class="s1">'complete -F __start_kubectl k'</span> <span class="o">&gt;&gt;</span> /etc/profile

<span class="c">## kubectx kubens install</span>
git clone https://github.com/ahmetb/kubectx /opt/kubectx
ln <span class="nt">-s</span> /opt/kubectx/kubens /usr/local/bin/kubens
ln <span class="nt">-s</span> /opt/kubectx/kubectx /usr/local/bin/kubectx

<span class="c">## kube-ps1 install</span>
git clone https://github.com/jonmosco/kube-ps1.git /root/kube-ps1
<span class="nb">cat</span> &lt;&lt;<span class="s2">"EOT"</span> <span class="o">&gt;&gt;</span> ~/.bash_profile
<span class="nb">source</span> /root/kube-ps1/kube-ps1.sh
<span class="nv">KUBE_PS1_SYMBOL_ENABLE</span><span class="o">=</span><span class="nb">true
</span><span class="k">function </span>get_cluster_short<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | cut <span class="nt">-d</span> <span class="nb">.</span> <span class="nt">-f1</span>
<span class="o">}</span>
<span class="nv">KUBE_PS1_CLUSTER_FUNCTION</span><span class="o">=</span>get_cluster_short
<span class="nv">KUBE_PS1_SUFFIX</span><span class="o">=</span><span class="s1">') '</span>
<span class="nv">PS1</span><span class="o">=</span><span class="s1">'$(kube_ps1)'</span><span class="nv">$PS1</span>
EOT
kubectl config rename-context <span class="s2">"kubernetes-admin@kubernetes"</span> <span class="s2">"admin-k8s"</span>

<span class="c">## kube-tail install</span>
curl <span class="nt">-O</span> https://raw.githubusercontent.com/johanhaleby/kubetail/master/kubetail
chmod 744 kubetail <span class="o">&amp;&amp;</span> mv kubetail /usr/bin
curl <span class="nt">-o</span> /root/kubetail.bash https://raw.githubusercontent.com/johanhaleby/kubetail/master/completion/kubetail.bash
<span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh"> &gt;&gt; ~/.bash_profile
source /root/kubetail.bash
</span><span class="no">EOT
</span></code></pre></div></div> <h3 id="workersh--워커-노드-설정script-파일">worker.sh : 워커 노드 설정(script) 파일</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>

<span class="c"># config for work_nodes only </span>
kubeadm join <span class="nt">--token</span> 123456.1234567890123456 <span class="nt">--discovery-token-unsafe-skip-ca-verification</span> 192.168.100.10:6443
</code></pre></div></div> <h3 id="kube-flannelyml--플라넬-파일-기본-설정-파일에서-변경-사항---링크">kube-flannel.yml : 플라넬 파일 기본 설정 파일에서 변경 사항 - <a href="https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml">링크</a></h3> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 아래 파드의 CIDR 대역을 **172.16.0.0/16** 으로 변경</span>
<span class="s">net-conf.json</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="no">{</span>
      <span class="no">"**Network**": "**172.16.0.0/16**",</span>
      <span class="no">"Backend": {</span>
        <span class="no">"Type": "vxlan"</span>
      <span class="no">}</span>
    <span class="no">}</span>
<span class="s">...</span>

<span class="c1"># 플라넬 파드에 args 에 **--iface=enp0s8** 추가 (enp0s3 로 flannel 동작하기 않게 하기 위해)</span>
<span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kube-flannel</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">rancher/mirrored-flannelcni-flannel:v0.16.1</span>
        <span class="na">command</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">/opt/bin/flanneld</span>
        <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">--ip-masq</span>
        <span class="pi">-</span> <span class="s">--kube-subnet-mgr</span>
        <span class="pi">-</span> <span class="err">*</span><span class="nv">*--iface</span><span class="s">=enp0s8**</span>
</code></pre></div></div> <p><img src="/assets/img/post_img/kang_2week_1.png" alt="" /></p> <h3 id="설치-및-확인">설치 및 확인</h3> <h4 id="k8s-설치">K8S 설치</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 빈 디렉토리를 생성 후 사용해주세요</span>
<span class="c"># vagrant 파일 다운로드</span>
<span class="nv">$ </span>curl <span class="nt">-O</span> https://raw.githubusercontent.com/gasida/KANS/main/2/Vagrantfile

<span class="c"># 배포</span>
<span class="nv">$ </span>vagrant up
</code></pre></div></div> <h4 id="확인">확인</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 배포 확인</span>
<span class="nv">$ </span>vagrant status

<span class="c"># ssh 접속 : 참고(root 계정암호: qwe123)</span>
<span class="c">## 마스터노드 접속</span>
<span class="nv">$ </span>vagrant ssh k8s-m

<span class="c">## k8s 클러스터에 노드 확인</span>
<span class="nv">$ </span>kubectl get nodes
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span>

<span class="c">## 워커노드 접속 : 참고(root 계정암호: qwe123)</span>
<span class="nv">$ </span>vagrant ssh k8s-w1
<span class="nv">$ </span>vagrant ssh k8s-w2
</code></pre></div></div> <p><img src="/assets/img/post_img/kang_2week_2.png" alt="" /></p> <h2 id="쿠버네티스-아키텍처">쿠버네티스 아키텍처</h2> <ul> <li>Kubernetes Components : K8S 클러스터는 Controle Plane(마스터)와 Node(노드)로 구성 - <a href="https://kubernetes.io/docs/concepts/overview/components/">링크</a></li> </ul> <p><img src="/assets/img/post_img/kang_2week_3.png" alt="" /> <img src="/assets/img/post_img/kang_2week_4.gif" alt="" /></p> <h3 id="control-plane마스터-노드-핵심-컴포넌트--마스터는-단일-서버-혹은-고가용성을-위한-클러스터-마스터로-구축"><code class="highlighter-rouge">Control Plane(마스터 노드) 핵심 컴포넌트</code> : 마스터는 단일 서버 혹은 고가용성을 위한 클러스터 마스터로 구축</h3> <ul> <li><code class="highlighter-rouge">kube</code>-<strong>apiserver</strong> : 마스터로 전달되는 <strong>모든 요청</strong>을 받아 드리는 <strong>API 서버</strong> - (심화) <a href="https://coffeewhale.com/apiserver">링크1</a> <a href="https://youtu.be/_65Md2qar14">링크2</a> <a href="https://iximiuz.com/en/posts/kubernetes-api-structure-and-terminology/">링크3</a></li> <li><code class="highlighter-rouge">etcd</code> : 클러스터내 모든 메타 정보를 저장하는 서비스</li> <li><code class="highlighter-rouge">kube-scheduler</code> : 사용자의 요청에 따라 적절하게 컨테이너를 워커 노드에 배치하는 스케줄러</li> <li><code class="highlighter-rouge">kube-controller-manager</code> : 현재 상태와 바라는 상태를 지속적으로 확인하며 특정 이벤트에 따라 특정 동작을 수행하는 컨트롤러 - <a href="https://kubernetes.io/docs/concepts/architecture/controller/">링크</a></li> <li><code class="highlighter-rouge">cloud-controller-manager</code> : 클라우드 플랫폼(AWS, GCP, Azure 등)에 특화된 리소스를 제어하는 클라우드 컨트롤러 - <a href="https://kubernetes.io/docs/concepts/architecture/cloud-controller/">링크</a></li> </ul> <h3 id="worker워커-노드---링크"><code class="highlighter-rouge">Worker(워커 노드)</code> - <a href="https://kubernetes.io/docs/concepts/architecture/nodes/">링크</a></h3> <ul> <li><code class="highlighter-rouge">kubelet</code> : 마스터의 명령에 따라 컨테이너의 라이프 사이클을 관리하는 노드 관리자</li> <li><code class="highlighter-rouge">kube-proxy</code> : 컨테이너의 네트워킹을 책임지는 프록시, 네트워크 규칙을 유지 관리</li> <li><code class="highlighter-rouge">Container Runtime</code> : 실제 컨테이너를 실행하는 컨테이너 실행 환경, (<del>Docker</del> &amp; containerD &amp; CRI-O)</li> </ul> <h3 id="cni--container-network-interface-는-k8s-네트워크-환경을-구성해준다---링크--다양한-플러그인이-존재---링크"><code class="highlighter-rouge">CNI</code> : Container Network Interface 는 k8s 네트워크 환경을 구성해준다 - <a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/">링크</a>, 다양한 플러그인이 존재 - <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/#networking-and-network-policy">링크</a></h3> <ul> <li><code class="highlighter-rouge">K8S 클러스터 네트워킹</code> - <a href="https://kubernetes.io/ko/docs/concepts/cluster-administration/networking/">링크</a> <a href="https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/">링크2</a></li> </ul> <h4 id="k8s-가-해결해야될-4가지-네트워크-문제">K8S 가 해결해야될 4가지 네트워크 문제</h4> <ol> <li>Highly-coupled container-to-container communications: this is solved by <a href="https://kubernetes.io/docs/concepts/workloads/pods/">Pods</a> and localhost communications. <ul> <li>파드에 여러개의 컨테이너가 동작 시, pause 컨테이너의 netns 를 공유하여 컨테이너들간 통신은 localhost 로 통신 가능!</li> </ul> </li> <li>Pod-to-Pod communications: this is the primary focus of this document. <ul> <li>파드 ↔ 파드 간 NAT 없이 통신할 수 있다.</li> </ul> </li> <li>Pod-to-Service communications: this is covered by services. <ul> <li>파드 ↔ 서비스 간 통신 가능!</li> </ul> </li> <li>External-to-Service communications: this is covered by services. <ul> <li>외부 ↔ 서비스 간 통신 가능</li> </ul> </li> </ol> <h4 id="k8s-네트워크-동작-기준">K8S 네트워크 동작 기준</h4> <ol> <li>pods on a node can communicate with all pods on all nodes without NAT <ul> <li>파드 ↔ 파드 간 NAT 없이 통신할 수 있다.</li> </ul> </li> <li>agents on a node (e.g. system daemons, kubelet) can communicate with all pods on that node <ul> <li>노드의 에이전트(예: 시스템 데몬, kubelet)는 모든 파드와 통신할 수 있다.</li> </ul> </li> <li>pods in the host network of a node can communicate with all pods on all nodes without NAT <ul> <li>노드의 호스트 네트워크에 있는 파드는 NAT 없이 모든 노드에 있는 모든 파드와 통신할 수 있다.</li> </ul> </li> <li>IP range from which to assign service cluster IPs. This must not overlap with any IP ranges assigned to nodes for pods <ul> <li>서비스 클러스터 IP 대역은 각 노드의 파드 IP 대역과 겹치지 않아야 한다. <ul> <li><img src="/assets/img/post_img/kang_2week_5.png" alt="" /> <a href="https://coffeewhale.com/packet-network1">https://coffeewhale.com/packet-network1</a></li> </ul> </li> <li>리눅스 컨테이너의 네트워크 인터페이스를 설정할 수 있도록 도와주는 일련의 명세와 라이브러리로 구성</li> <li>CNI 는 오직 ‘컨테이너의 네트워크 연결성’ 과 ‘컨테이너 삭제 시 관련된 네트워크 리소스 해제’에 대해서만 관여. 그 외의 구체적인 사안에 대한 제한이 없음.</li> <li>이를 실행하는 runtime 는 어떤 것이든 상관없음 (k8s, podman, cloud foundry 등)</li> </ul> </li> </ol> <h3 id="dns--쿠버네티스-서비스를-위해-dns-레코드를-제공해주며-service-discovery-기능을-제공을-한다-대표적으로-coredns-가-있다---링크"><code class="highlighter-rouge">DNS</code> : 쿠버네티스 서비스를 위해 DNS 레코드를 제공해주며, Service Discovery 기능을 제공을 한다. 대표적으로 CoreDNS 가 있다 - <a href="https://coredns.io/">링크</a></h3> <ul> <li>Service Discovery (서비스 탐색) <ul> <li>쿠버네티스는 클러스터내에서 통신하기 위해 노드 위치와는 상관없이 어디서든 접근할 수 있는 서비스 끝점(Service Endpoint)이 필요합니다. 사용자(또는 Pod)는 서비스 끝점을 통해 다른 컨테이너(Pod)와 통신할 수 있습니다. 이를 위해 사용자는 서비스에 접근하기 위한 끝점의 접속 정보(예를 들면 IP)를 알아야 합니다. 이를 서비스 탐색(Service Discovery)이라 합니다. 쿠버네티스에서는 DNS 기반의 서비스 탐색을 지원하기에 사용자가 매번 새로운 서비스의 IP를 찾을 필요 없이 도메인 주소를 기반으로 서비스에 접근할 수 있습니다. 쿠버네티스에서는 서비스 탐색 기능을 Service 라는 리소스를 이용하여 제공합니다.</li> </ul> </li> </ul> <h3 id="그외-대시보드-모니터링-로깅-등등이-있다">그외 대시보드, 모니터링, 로깅 등등이 있다</h3> <h2 id="쿠버네티스-핵심-개념">쿠버네티스 핵심 개념</h2> <h3 id="애완동물-vs-가축">애완동물 VS 가축</h3> <p>쿠버네티스는 서버를 <code class="highlighter-rouge">애완동물</code>(Pet)보다는 <code class="highlighter-rouge">가축</code>(cattle)에 가깝다고 비유합니다.</p> <p><code class="highlighter-rouge">애완동물</code>은 세심한 관리가 필요하고 가축은 떼로 방목하여 키웁니다. 애완동물은 개체마다 정해진 이름이 있고, 배고프지 말라고 끼니를 챙겨주며, 아프지 말라고 예방 접종을 합니다.</p> <p>반면, <code class="highlighter-rouge">가축</code>은 개별적으로 정해진 이름 없이 무리로 관리합니다. 때로 무리에서 낙오된 개체는 죽기도 합니다. 애완동물과는 다르게 가축 한두 마리 죽는 것에 크게 슬퍼하지 않습니다. 워낙 개체수가 많으니까요.</p> <p>다음의 예로 쿠버네티스의 서버관리 관점을 확인해봅니다.</p> <h4 id="첫째-서버마다-특별한-이름을-부여하지-않습니다">첫째, 서버마다 특별한 이름을 부여하지 않습니다.</h4> <p>예를 들어, 특정 서버의 역할을 빌드 서버, 웹 서버, 모니터링 서버 등으로 구분하지 않습니다. 모든 서버들은 워커 서버로 동작합니다.</p> <h4 id="둘째-가축과-마찬가지로-한두-개의-서버워커-노드가-망가져도-문제없습니다">둘째, 가축과 마찬가지로 한두 개의 서버(워커 노드)가 망가져도 문제없습니다.</h4> <p>손쉽게 다른 서버에게 그 역할을 맡길 수 있습니다. 쿠버네티스 안에서는 모든 서버들이 <code class="highlighter-rouge">마스터</code>와 <code class="highlighter-rouge">워커</code>로만 구분됩니다. 마스터에서는 쿠버네티스를 운용하기 위한 필수적인 핵심 컴포넌트가 존재하고, 나머지 워커 노드들은 단순히 컨테이너를 실행하는 환경으로 사용합니다. 워커마다 특별한 역할을 맡지 않기 때문에 마스터가 죽지 않은 이상 특정 워커가 수행했던 역할을 나머지 워커들에 맡겨도 문제없습니다. 이것은 컨테이너라는 고립화된 가상실행 환경을 통해 이식성을 높였기에 가능한 일입니다. 이러한 특징으로, 많은 수의 서버를 관리하기에 수월합니다.</p> <h3 id="바라는-상태desired-state----컨트롤러-특정-리소스를-지속적으로-바라보며-리소스의-생명주기에-따라-미리-정해진-작업을-수행하는-주체">바라는 상태(Desired State) - <code class="highlighter-rouge">컨트롤러</code> (특정 리소스를 지속적으로 바라보며 리소스의 생명주기에 따라 미리 정해진 작업을 수행하는 주체)</h3> <p>에어콘을 사용할 때, 현재 상태가 존재하고(=현재 온도), 사용자가 <code class="highlighter-rouge">바라는 상태</code>(=희망 온도)가 있습니다.</p> <p>에어컨 시스템이 사용자의 희망온도에 따라 현재 상태를 변경시키기 위해 에어컨 시스템을 작동시키듯, 쿠버네티스는 사용자의 요청에 따라 현재 상태가 바라는 상태와 동일해지도록 사전이 미리 정의된 특정 작업을 수행합니다.</p> <p>쿠버네티스에서 <code class="highlighter-rouge">바라는 상태</code>란 <code class="highlighter-rouge">사용자가 생각하는 최종 애플리케이션 배포 상태</code>를 말합니다.</p> <p>사용자는 자신이 원하는 애플리케이션 배포 상태를 쿠버네티스에 알려주면 쿠버네티스가 자동으로 현재 상태를 바라는 상태로 변경합니다.</p> <p>바라는 상태가 가지는 것의 장점으로는 쿠버네티스가 장애가 발생하여 애플리케이션이 죽더라도, 바라는 상태를 알기 때문에 손쉽게 원래의 바라는 상태로 배포 상태를 되살릴 수가 있습니다(=<strong>자가 치유</strong>)</p> <p><img src="/assets/img/post_img/kang_2week_6.png" alt="" /> [그림 출처:책] 핵심만 콕 쿠버네티스</p> <h3 id="네임스페이스namespace">네임스페이스(Namespace)</h3> <blockquote> <p>도커에서 학습한 네임스페이스와는 <strong>다른 개념</strong>입니다!</p> </blockquote> <p>클러스터를 논리적으로 분리하는 네임스페이스라는 개념이 있습니다.</p> <p>네임스페이스마다 서로 다른 권한 설정을 할 수 있으며, 네트워크 정책 등을 설정할 수 있습니다.</p> <p>쿠버네티스의 모든 리소스를 크게 두 가지로 구분하자면 <code class="highlighter-rouge">네임스페이스 레벨 리소스</code>와 <code class="highlighter-rouge">클러스터 레벨 리소스</code>로 구분이 됩니다.</p> <p><img src="/assets/img/post_img/kang_2week_7.png" alt="" /> [그림 출처:책] 핵심만 콕 쿠버네티스</p> <p>네임스페이스 리소스는 특정 네임스페이스 안에 속하여 존재합니다. <code class="highlighter-rouge">Pod</code>, <code class="highlighter-rouge">Deployment</code>, <code class="highlighter-rouge">Service</code> 와 같이 대부분의 쿠버네티스 리소스가 네임스페이스 안에 포함됩니다.</p> <p>반면, <code class="highlighter-rouge">Node</code>, <code class="highlighter-rouge">PersistentVolume</code>, <code class="highlighter-rouge">StorageClass</code> 와 같이 네임스페이스 영역에 상관없이 클러스터 레벨에서 존재하는 리소스도 있습니다.</p> <h3 id="쿠버네티스-리소스resource-오브젝트">쿠버네티스 <strong>리소스</strong>(Resource), <strong>오브젝트</strong></h3> <p>쿠버네티스는 모든 것이 <code class="highlighter-rouge">리소스(Resource)</code>로 표현됩니다.</p> <p>Pod, ReplicaSet, Deployment 등 다양한 리소스가 존재하고 각각 역할이 있습니다.</p> <p><code class="highlighter-rouge">컨테이너의 집합(Pods)</code>, 컨테이너의 집합을 관리하는 <code class="highlighter-rouge">컨트롤러(Replica Set)</code>, 심지어 <code class="highlighter-rouge">사용자(Service Account)</code>, <code class="highlighter-rouge">노드(Node)</code> 까지도 하나의 <strong>오브젝트</strong>로 표현 가능합니다.</p> <p>리소스마다 세부 정의가 다르고 그에 따른 역할과 동작 방식이 다르지만 모두 리소스로 표현됩니다.</p> <p>쿠버네티스의 가장 기본적인 리소스는 <strong>Pod</strong>입니다. Pod는 하나 이상의 컨테이너를 가지는 쿠버네티스의 <strong>최소 실행 단위</strong>입니다.</p> <p>쿠버네티스에서 프로세스(컨테이너)를 실행한다는 의미는 Pod 리소스를 생성하는 것과 같다고 볼 수 있습니다.</p> <ul> <li>K8S 에서 사용할 수 있는 오브젝트 확인</li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># K8s 사용할 수 있는 오브젝트 확인</span>
<span class="nv">$ </span>kubectl api-resources

<span class="c"># 특정 오브젝트 설명</span>
<span class="nv">$ </span>kubectl explain pod

<span class="c"># 특정 오브젝트의 하위 필드의 정보 확인</span>
<span class="nv">$ </span>kubectl explain pod.spec | more

<span class="c"># 특정 오브젝트의 모든 하위 필드 정보 확인</span>
<span class="nv">$ </span>kubectl explain pod <span class="nt">--recursive</span> | more
</code></pre></div></div> <h3 id="선언형-커맨드declarative-command">선언형 커맨드(Declarative Command)</h3> <p>쿠버네티스에서는 <strong>선언형 커맨드</strong>(Declarative Command)를 지향합니다.</p> <p>선언형 커맨드란 사용자가 직접 시스템의 상태를 바꾸지 않고 사용자가 바라는 상태를 선언적으로 기술하여 명령을 내리는 방법을 말합니다.</p> <p>선언형 커맨드와 반대되는 개념이 <strong>명령형(Imperative) 커맨드</strong>입니다. 명령형 커맨드는 일반적으로 자주 사용하는 명령 형식입니다.</p> <p>명령형 커맨드의 예로 SQL 쿼리를 들 수 있습니다. SQL 쿼리는 어떻게 테이블의 데이터를 질의할 것인가에 대한 명령입니다. 대부분 명령이 이런 명령형 커맨드에 기반합니다.</p> <p>반면, 선언형 커맨드의 대표적인 예로 HTML 문서를 들 수 있습니다. HTML 문서는 어떻게 명령을 수행해야 할지에 대한 정보는 없습니다.</p> <p>대신 무엇을 해야 하는지 선언되어 있습니다.</p> <p>쿠버네티스는 YAML 형식을 이용하여 선언형 명령을 내립니다. 다음은 쿠버네티스에서 사용하는 YAML 형식의 리소스(Pod) 예시입니다.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
</code></pre></div></div> <p>이러한 YAML 형식의 리소스를 ‘YAML 정의서(YAML description)’ 라고 부릅니다.</p> <p>사용자는 쿠버네티스에 어떤 명령을 전달하거나 옵션값을 수정할 때 YAML 정의서의 YAML property를 추가하거나 수정합니다.</p> <p><strong>사용자는 각 리소스마다의 모든 설정값을 외울 필요가 없습니다. 최소한의 필수값을 채워서 리소스를 생성하면, 나머지는 쿠버네티스가 기본값으로 리소스를 생성합니다.</strong></p> <p><img src="/assets/img/post_img/kang_2week_8.png" alt="" /></p> <h3 id="highly-available-구성---링크"><code class="highlighter-rouge">Highly Available 구성</code> - <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology/">링크</a></h3> <ul> <li><code class="highlighter-rouge">Control Plane(마스터 노드) HA 설정</code> : 마스터 노드 3대(5대…) 구성 및 외부 LB(혹은 keepalived)를 통한 API 단일 진입점 구성</li> <li>kubeadm HA topology - <code class="highlighter-rouge">stacked etcd</code></li> </ul> <p><img src="/assets/img/post_img/kang_2week_9.png" alt="방안1 - 외부 LB 사용" /></p> <p>방안1 - 외부 LB 사용</p> <ul> <li>kubeadm HA topology - <code class="highlighter-rouge">external etcd</code></li> </ul> <p><img src="/assets/img/post_img/kang_2week_10.png" alt="ETCD 를 control plane node 와 분리" /></p> <p>ETCD 를 control plane node 와 분리</p> <p><img src="/assets/img/post_img/kang_2week_11.png" alt="방안2 - 노드에 keepalived 활용" /></p> <p>방안2 - 노드에 keepalived 활용</p> <ul> <li>(심화) ETCD 기본 동작 원리의 이해 - <a href="https://tech.kakao.com/2021/12/20/kubernetes-etcd/">링크</a> &amp; ETCD? - <a href="https://blog.frec.kr/cloud/etcd/">링크</a></li> </ul> <h2 id="참고-자료">참고 자료</h2> <ul> <li>K8S Docs - <a href="https://kubernetes.io/docs/concepts/overview/components/">Components</a> &amp; <a href="https://kubernetes.io/docs/concepts/architecture/">Cluster Architecture</a> &amp; <a href="https://kubernetes.io/docs/concepts/workloads/pods/">Pods</a> &amp; <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/">Learn Kubernetes Basics</a> &amp; <a href="https://kubernetes.io/ko/docs/reference/kubectl/cheatsheet/">치트 시트</a></li> <li>K8S Blog (v1.22) - <a href="https://kubernetes.io/blog/2021/08/04/kubernetes-1-22-release-announcement/">New Peaks</a> &amp; <a href="https://kubernetes.io/blog/2021/07/26/update-with-ingress-nginx/">Nginx-Ingress</a> &amp; <a href="https://kubernetes.io/blog/2021/07/14/upcoming-changes-in-kubernetes-1-22/">API</a></li> <li>CNCF - <a href="https://www.cncf.io/">링크</a> &amp; CNCF Landscape - <a href="https://landscape.cncf.io/">링크</a></li> <li>44bits(Youtube) - <a href="https://www.youtube.com/playlist?list=PLIUCBpK1dpsNf1m-2kiosmfn2nXfljQgb">초보를 위한 쿠버네티스 안내서</a> &amp; Subicura(WebSite) - <a href="https://subicura.com/k8s/">실습편</a></li> <li>[devinjeon] Container &amp; Pod - <a href="https://speakerdeck.com/devinjeon/containerbuteo-dasi-salpyeoboneun-kubernetes-pod-dongjag-weonri">링크</a></li> <li>[learnk8s] Tracing the path of network traffic in Kubernetes - <a href="https://learnk8s.io/kubernetes-network-packets">링크</a></li> <li>(심화) ETCD 기본 동작 원리의 이해 - <a href="https://tech.kakao.com/2021/12/20/kubernetes-etcd/">링크</a> &amp; ETCD? - <a href="https://blog.frec.kr/cloud/etcd/">링크</a></li> </ul> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://lahuman.github.io/tags/#kang" title="Pages tagged kang" class="tag"><span class="term">kang</span></a><a href="https://lahuman.github.io/tags/#network" title="Pages tagged network" class="tag"><span class="term">network</span></a><a href="https://lahuman.github.io/tags/#kubernetes" title="Pages tagged kubernetes" class="tag"><span class="term">kubernetes</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://lahuman.github.io/kang_2week_1/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://lahuman.github.io/kang_2week_1/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://lahuman.github.io/kang_2week_1/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-ubp67fs9s850" data-ad-width = "320" data-ad-height = "100"></ins> <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://lahuman.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://lahuman.github.io/assets/js/scripts.js"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74095083-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-74095083-1'); </script> <script type="text/javascript"> var disqus_shortname = 'daniels-blog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
