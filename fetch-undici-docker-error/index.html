<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Docker에서 curl은 되는데 Node.js fetch만 실패할 때 (feat. undici) &#8211; lahuman</title> <meta name="description" content="열심히 사는 아저씨"> <meta name="keywords" content="fetch, curl, undici, network"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://lahuman.github.io/assets/img/logo.png"> <meta name="twitter:title" content="Docker에서 curl은 되는데 Node.js fetch만 실패할 때 (feat. undici)"> <meta name="twitter:description" content="http 또는 Axios 를 이용하면 간단하게 해결"> <!-- Open Graph --> <meta property="og:locale" content="ko_KR"> <meta property="og:type" content="article"> <meta property="og:title" content="Docker에서 curl은 되는데 Node.js fetch만 실패할 때 (feat. undici)"> <meta property="og:description" content="http 또는 Axios 를 이용하면 간단하게 해결"> <meta property="og:url" content="https://lahuman.github.io/fetch-undici-docker-error/"> <meta property="og:site_name" content="lahuman"> <meta property="og:image" content="https://lahuman.github.io/assets/img/logo.png"> <link rel="canonical" href="https://lahuman.github.io/fetch-undici-docker-error/"> <link href="https://lahuman.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="lahuman Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://lahuman.github.io/assets/css/main.css"> <!-- JS --> <script src="https://lahuman.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://lahuman.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://lahuman.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://lahuman.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://lahuman.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://lahuman.github.io/favicon.png" /> <link rel="shortcut icon" href="https://lahuman.github.io/favicon.ico" /> <!-- mermaid --> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script>mermaid.initialize({startOnLoad:true});</script> <!-- Background Image --> <style type="text/css">body {background-image:url(https://lahuman.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://lahuman.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://lahuman.github.io/assets/img/logo.png" alt="lahuman photo" class="author-photo"> <h4>lahuman</h4> <p>열심히 사는 아저씨</p> </li> <li><a href="https://lahuman.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://facebook.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://linkedin.com/in/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://lahuman.github.io/posts/">All Posts</a></li> <li><a href="https://lahuman.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://lahuman.github.io/projects/" >Projects</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Docker에서 curl은 되는데 Node.js fetch만 실패할 때 (feat. undici)</h1> <h4>20 Oct 2025</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~3 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://lahuman.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>개발을 하다 보면 Docker 컨테이너 내부에서 호스트 머신(PC)의 API를 호출해야 하는 경우가 종종 있습니다.</p> <p>일반적으로 Docker for Mac/Windows에서는 <code class="highlighter-rouge">host.docker.internal</code>을 사용하지만, Linux 환경에서는 Docker 브리지의 기본 게이트웨이 주소인 <code class="highlighter-rouge">172.17.0.1</code>을 사용하는 경우가 많습니다.</p> <p>그런데 이 주소로 API를 호출하는 과정에서 매우 이상한 문제를 겪게 되어 트러블슈팅 과정을 공유해보고자 합니다.</p> <h2 id="증상-curl은-되는데-fetch는-실패">증상: curl은 되는데 fetch는 실패</h2> <p>먼저, 컨테이너 내부에서 호스트(<code class="highlighter-rouge">172.17.0.1</code>)로 네트워크 연결이 되는지 확인하기 위해 <code class="highlighter-rouge">curl</code> 명령어를 사용했습니다.</p> <p>”"”bash eb7b0d89f82b:/app# curl http://172.17.0.1:6000/webhook/…. -v</p> <ul> <li>Trying 172.17.0.1:6000…</li> <li>Connected to 172.17.0.1 (172.17.0.1) port 6000 … &lt; HTTP/1.1 401 Unauthorized &lt; WWW-Authenticate: Basic realm=”Webhook” … Authorization is required! “””</li> </ul> <p><code class="highlighter-rouge">401 Unauthorized</code> 응답이 왔습니다. 이는 서버가 인증을 요구한다는 뜻으로, <strong>네트워크 연결 자체는 성공</strong>했다는 의미입니다.</p> <p>그런데 동일한 주소를 Node.js의 <code class="highlighter-rouge">fetch</code> API를 사용하여 호출하면 다른 결과가 나옵니다.</p> <p>”"”javascript // test.js // (인증 로직은 편의상 생략) const url = ‘http://172.17.0.1:6000/webhook/….’;</p> <p>try { const response = await fetch(url, { method: ‘GET’ }); console.log(await response.text()); } catch (error) { console.error(‘Error calling webhook:’, error.message); } “””</p> <p>”"”bash eb7b0d89f82b:/app# node test.js</p> <p>Error calling webhook: fetch failed “””</p> <p>분명 <code class="highlighter-rouge">curl</code>로는 연결이 되는데, 왜 Node.js의 <code class="highlighter-rouge">fetch</code>만 <code class="highlighter-rouge">fetch failed</code>라는 네트워크 연결 실패 오류를 반환하는 것일까요?</p> <h2 id="원인-curl과-fetch는-다르다">원인: curl과 fetch는 다르다</h2> <p>이 문제의 핵심은 <strong><code class="highlighter-rouge">curl</code>과 Node.js의 <code class="highlighter-rouge">fetch</code>가 동일하게 작동하지 않는다</strong>는 점입니다.</p> <ol> <li><strong><code class="highlighter-rouge">curl</code></strong>: C언어로 작성된, 매우 표준적이고 검증된 저수준(low-level) HTTP 클라이언트입니다.</li> <li><strong>Node.js <code class="highlighter-rouge">fetch</code></strong>: Node.js 18 버전부터 내장된 <code class="highlighter-rouge">fetch</code> API는 <strong><code class="highlighter-rouge">undici</code></strong>라는 이름의 별도 HTTP 클라이언트 라이브러리를 기반으로 합니다.</li> </ol> <p>즉, <code class="highlighter-rouge">curl</code>이 성공했다는 것은 “네트워크 경로, IP, 포트, 방화벽”은 모두 정상이란 뜻입니다.</p> <p><code class="highlighter-rouge">fetch failed</code>가 발생한 이유는, Node.js의 <code class="highlighter-rouge">undici</code> 구현체가 특정 Docker 네트워크 환경(이 경우 <code class="highlighter-rouge">172.17.0.1</code> 게이트웨이)과 통신하는 과정에서 호환성 문제를 일으켰기 때문입니다. (주로 IPv6/IPv4 처리 방식 차이나 커넥션 풀링 방식의 차이로 인해 발생하곤 합니다)</p> <h3 id="axios는-어떨까요"><code class="highlighter-rouge">axios</code>는 어떨까요?</h3> <p>흥미롭게도, 이 상황에서 <code class="highlighter-rouge">axios</code> 라이브러리를 사용하면 대부분 성공합니다.</p> <p>”"”javascript import axios from ‘axios’; // const response = await axios.get(url, { auth: { … } }); “””</p> <p><code class="highlighter-rouge">axios</code>가 성공하는 이유는 <code class="highlighter-rouge">undici</code>와 다르게, Node.js의 <strong>내장 <code class="highlighter-rouge">http</code> 모듈</strong>을 기반으로 작동하기 때문입니다. 이 <code class="highlighter-rouge">http</code> 모듈은 <code class="highlighter-rouge">curl</code>과 유사하게 더 고전적이고 단순한 방식으로 통신하므로 호환성 문제를 피할 수 있었던 것입니다.</p> <h2 id="해결-undici를-우회하기">해결: <code class="highlighter-rouge">undici</code>를 우회하기</h2> <p>원인을 알았으니 해결 방법은 명확합니다. <code class="highlighter-rouge">undici</code> 기반의 <code class="highlighter-rouge">fetch</code> 대신, <code class="highlighter-rouge">http</code> 모듈 기반의 클라이언트를 사용하면 됩니다.</p> <h3 id="방법-1-axios-라이브러리-사용-권장">방법 1. <code class="highlighter-rouge">axios</code> 라이브러리 사용 (권장)</h3> <p>가장 간단하고 현대적인 방법입니다. <code class="highlighter-rouge">npm</code>이나 <code class="highlighter-rouge">yarn</code>으로 <code class="highlighter-rouge">axios</code>를 설치하고 코드를 수정합니다.</p> <p>”"”bash</p> <h1 id="esm-환경에서-require-오류가-났던-것을-기억합니다">ESM 환경에서 require 오류가 났던 것을 기억합니다.</h1> <p>npm install axios “””</p> <p>”"”javascript // test.js import axios from ‘axios’; // require 대신 import 사용</p> <p>const url = ‘http://172.17.0.1:6000/webhook/….’;</p> <p>// 401 오류를 해결하기 위해 인증 정보 추가 const auth = { username: ‘YOUR_USERNAME’, password: ‘YOUR_PASSWORD’ };</p> <p>try { // axios는 auth 객체를 Basic 인증 헤더로 자동 변환해 줍니다. const response = await axios.get(url, { auth: auth });</p> <p>console.log(‘Webhook GET call successful!’); console.log(‘Status Code:’, response.status); console.log(‘Server response:’, response.data);</p> <p>} catch (error) { // … (Axios 오류 처리) … console.error(‘Error calling webhook:’, error.message); } “””</p> <h3 id="방법-2-nodejs-내장-http-모듈-사용">방법 2. Node.js 내장 <code class="highlighter-rouge">http</code> 모듈 사용</h3> <p><code class="highlighter-rouge">axios</code> 같은 외부 라이브러리를 설치하기 어려운 환경이라면, Node.js에 100% 내장된 <code class="highlighter-rouge">http</code> 모듈을 직접 사용할 수 있습니다. <code class="highlighter-rouge">curl</code>과 거의 동일하게 작동합니다.</p> <p>”"”javascript // test.js (Node.js 내장 http 모듈 사용) import http from ‘http’; // ESM 방식 import { URL } from ‘url’; // URL 파싱을 위해 추가</p> <p>const urlString = ‘http://172.17.0.1:6000/webhook/….’;</p> <p>// 인증 정보 const credentials = ‘YOUR_USERNAME:YOUR_PASSWORD’; const encodedCredentials = Buffer.from(credentials).toString(‘base64’);</p> <p>const { hostname, port, pathname } = new URL(urlString);</p> <p>const options = { hostname: hostname, port: port, path: pathname, method: ‘GET’, headers: { ‘Authorization’: <code class="highlighter-rouge">Basic ${encodedCredentials}</code> } };</p> <p>const req = http.request(options, (res) =&gt; { console.log(<code class="highlighter-rouge">Status Code: ${res.statusCode}</code>); let data = ‘’; res.on(‘data’, (chunk) =&gt; { data += chunk; }); res.on(‘end’, () =&gt; { console.log(‘Server response:’, data); }); });</p> <p>req.on(‘error’, (error) =&gt; { // 이 오류는 ‘fetch failed’와 동일한 네트워크 오류입니다. console.error(‘Error calling webhook:’, error.message); });</p> <p>req.end(); “””</p> <h2 id="마무리">마무리</h2> <p><code class="highlighter-rouge">fetch failed</code>라는 단순한 오류 메시지를 만났을 때, 무조건 네트워크 방화벽이나 IP 주소 문제라고 단정 짓기 쉽습니다.</p> <p>하지만 <code class="highlighter-rouge">curl</code>과 같은 기본 도구로 교차 검증을 해보니, 문제는 네트워크가 아니라 <strong>Node.js의 <code class="highlighter-rouge">fetch</code> 구현체인 <code class="highlighter-rouge">undici</code></strong>와 특정 Docker 네트워크 환경 간의 호환성 문제임을 알 수 있었습니다.</p> <p>비슷한 문제를 겪으신다면, <code class="highlighter-rouge">fetch</code> 대신 <code class="highlighter-rouge">axios</code>나 <code class="highlighter-rouge">http</code> 기본 모듈을 사용해 보시는 것을 추천해 드립니다.</p> <p>읽어주셔서 감사합니다.</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://lahuman.github.io/tags/#fetch" title="Pages tagged fetch" class="tag"><span class="term">fetch</span></a><a href="https://lahuman.github.io/tags/#curl" title="Pages tagged curl" class="tag"><span class="term">curl</span></a><a href="https://lahuman.github.io/tags/#undici" title="Pages tagged undici" class="tag"><span class="term">undici</span></a><a href="https://lahuman.github.io/tags/#network" title="Pages tagged network" class="tag"><span class="term">network</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://lahuman.github.io/fetch-undici-docker-error/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://lahuman.github.io/fetch-undici-docker-error/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://lahuman.github.io/fetch-undici-docker-error/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-ubp67fs9s850" data-ad-width = "320" data-ad-height = "100"></ins> <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://lahuman.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://lahuman.github.io/assets/js/scripts.js"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74095083-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-74095083-1'); </script> <script type="text/javascript"> var disqus_shortname = 'daniels-blog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
