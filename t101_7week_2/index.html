<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>#7-2 í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ í…Œë¼í¼ ì½”ë“œ &#8211; lahuman</title> <meta name="description" content="ì—´ì‹¬íˆ ì‚¬ëŠ” ì•„ì €ì”¨"> <meta name="keywords" content="terraform, study"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://lahuman.github.io/assets/img/logo.png"> <meta name="twitter:title" content="#7-2 í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ í…Œë¼í¼ ì½”ë“œ"> <meta name="twitter:description" content="Terraform 101 Study"> <!-- Open Graph --> <meta property="og:locale" content="ko_KR"> <meta property="og:type" content="article"> <meta property="og:title" content="#7-2 í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ í…Œë¼í¼ ì½”ë“œ"> <meta property="og:description" content="Terraform 101 Study"> <meta property="og:url" content="https://lahuman.github.io/t101_7week_2/"> <meta property="og:site_name" content="lahuman"> <meta property="og:image" content="https://lahuman.github.io/assets/img/logo.png"> <link rel="canonical" href="https://lahuman.github.io/t101_7week_2/"> <link href="https://lahuman.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="lahuman Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://lahuman.github.io/assets/css/main.css"> <!-- JS --> <script src="https://lahuman.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://lahuman.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://lahuman.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://lahuman.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://lahuman.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://lahuman.github.io/favicon.png" /> <link rel="shortcut icon" href="https://lahuman.github.io/favicon.ico" /> <!-- mermaid --> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script>mermaid.initialize({startOnLoad:true});</script> <!-- Background Image --> <style type="text/css">body {background-image:url(https://lahuman.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://lahuman.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://lahuman.github.io/assets/img/logo.png" alt="lahuman photo" class="author-photo"> <h4>lahuman</h4> <p>ì—´ì‹¬íˆ ì‚¬ëŠ” ì•„ì €ì”¨</p> </li> <li><a href="https://lahuman.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://facebook.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://linkedin.com/in/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://lahuman.github.io/posts/">All Posts</a></li> <li><a href="https://lahuman.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://lahuman.github.io/projects/" >Projects</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>#7-2 í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ í…Œë¼í¼ ì½”ë“œ</h1> <h4>04 Dec 2022</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~19 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://lahuman.github.io/projects/"> <i class="fa fa-chevron-left"></i> </a> </div> <h1 id="í”„ë¡œë•ì…˜-ìˆ˜ì¤€ì˜-í…Œë¼í¼-ì½”ë“œ">í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ í…Œë¼í¼ ì½”ë“œ</h1> <h3 id="ì†Œê°œ">ì†Œê°œ</h3> <p><code class="language-plaintext highlighter-rouge">í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ ì¸í”„ë¼</code> By production-grade infrastructure</p> <ul> <li>ì„œë²„, ë°ì´í„° ì €ì¥ì†Œ, ë¡œë“œ ë°¸ëŸ°ì„œ, ë³´ì•ˆ ê¸°ëŠ¥, ëª¨ë‹ˆí„°ë§ ë° ê²½ê³  ë„êµ¬, íŒŒì´í”„ë¼ì¸ êµ¬ì¶• ë° ë¹„ì¦ˆë‹ˆìŠ¤ ìš´ì˜ì— í•„ìš”í•œ ê¸°íƒ€ ëª¨ë“  ê¸°ìˆ ì„ ì˜ë¯¸ + ì´ì¤‘í™” ë° ì¥ì•  ëŒ€ì‘ ê°€ëŠ¥</li> <li>í•„ìê°€ ê²½í—˜í•œ <strong>í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ ì¸í”„ë¼</strong>ë¥¼ ë§Œë“œëŠ” í”„ë¡œì íŠ¸ì— ì†Œìš”ë˜ëŠ” ëŒ€ëµì ì¸ ì‹œê°„</li> </ul> <table> <thead> <tr> <th>ì¸í”„ë¼ ìœ í˜•</th> <th>ì˜ˆ</th> <th>ì˜ˆìƒ ì†Œìš” ì‹œê°„</th> </tr> </thead> <tbody> <tr> <td>ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ Managed service</td> <td>Amazon RDS</td> <td>1~2ì£¼</td> </tr> <tr> <td>ìŠ¤ìŠ¤ë¡œ ê´€ë¦¬í•˜ëŠ” ë¶„ì‚° ì‹œìŠ¤í…œ (ìƒíƒœ ë¹„ì €ì¥)</td> <td>Â </td> <td>Â </td> </tr> <tr> <td>Self-managed distributed system (stateless)</td> <td>Node.js ì•±ì´ ì‹¤í–‰ë˜ëŠ” ASG í´ëŸ¬ìŠ¤í„°</td> <td>2~4</td> </tr> <tr> <td>ìŠ¤ìŠ¤ë¡œ ê´€ë¦¬í•˜ëŠ” ë¶„ì‚° ì‹œìŠ¤í…œ (ìƒíƒœ ì €ì¥)</td> <td>Â </td> <td>Â </td> </tr> <tr> <td>Self-managed distributed system (stateful)</td> <td>Amazon Elasticsearch cluster</td> <td>2~4ê°œì›”</td> </tr> <tr> <td>ì „ì²´ ì•„í‚¤í…ì²˜ Entire architecture</td> <td>ì• í”Œë¦¬ì¼€ì´ì…˜, ë°ì´í„° ì €ì¥ì†Œ, ë¡œë“œ ë°¸ëŸ°ì„œ, ëª¨ë‹ˆí„°ë§ ë“±</td> <td>6~36ê°œì›”</td> </tr> </tbody> </table> <blockquote> <p>ì‹¤ì œ í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ ì¸í”„ë¼ë¥¼ í…Œë¼í¼ìœ¼ë¡œ êµ¬ì„±í•´ë³¸ ê²½í—˜í•´ë³´ì‹  ë¶„ë“¤ì€ ëŒ€ëµ ì–¼ë§ˆì •ë„ì˜ ê¸°ê°„ì´ ì†Œìš”ë˜ì—ˆë‚˜ìš”?</p> </blockquote> <p>==&gt; ì œ ê²½ìš°ëŠ” ì „ì²´ êµ¬ì¡°ë¥¼ ì¡ëŠ”ë° 6ê°œì›” ê°€ëŸ‰ ì†Œìš” ë˜ì—ˆê³ , ì´ ë˜í•œ 3~4ë²ˆ ì´ìƒ êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ë©´ì„œ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.</p> <h3 id="1-í”„ë¡œë•ì…˜-ìˆ˜ì¤€-ì¸í”„ë¼-êµ¬ì¶•ì—-ì˜¤ëœ-ì‹œê°„ì´-ê±¸ë¦¬ëŠ”-ì´ìœ ">1. í”„ë¡œë•ì…˜ ìˆ˜ì¤€ ì¸í”„ë¼ êµ¬ì¶•ì— ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì´ìœ </h3> <p><strong>Why It Takes So Long to Build Production-Grade Infrastructure</strong></p> <p><strong>DevOps í”„ë¡œì íŠ¸</strong>ëŠ” ë‹¤ë¥¸ ìœ í˜•ì˜ ì†Œí”„íŠ¸ì›¨ì–´ í”„ë¡œì íŠ¸ ë³´ë‹¤ ë” <strong>ì‹œê°„ì´ ì†Œìš”</strong>ë  ìˆ˜ ìˆë‹¤. ì•„ë˜ ë²•ì¹™ì— ì˜ ë“¤ì–´ë§ëŠ” ì˜ˆì´ë‹¤</p> <ul> <li><strong>í˜¸í”„ìŠ¤íƒœí„°ì˜ ë²•ì¹™</strong> Hofstadterâ€™s Law : í˜¸í”„ìŠ¤íƒœí„°ì˜ ë²•ì¹™ì„ ê³„ì‚°ì— ë„£ì–´ë„ í•­ìƒ ì˜ˆìƒí•œ ê²ƒë³´ë‹¤ ë” ì˜¤ë˜ ê±¸ë¦°ë‹¤. <ol> <li><strong>ë°ë¸Œì˜µìŠ¤ ì‚°ì—…</strong>ì´ ì—¬ì „íˆ <strong>ì„ê¸° ì‹œëŒ€</strong>ì— ìˆê¸° ë•Œë¬¸ the industry is still in its <strong>infancy</strong></li> </ol> <ul> <li>ì•„ì§ ì‚°ì—…ì˜ ì´ˆê¸° ë‹¨ê³„ì´ë©°, â€˜Cloud Computing, IaC, DevOps, Docker, k8sâ€™ ë“± ë„êµ¬ì˜ ì¶œí˜„ê³¼ ê¸°ìˆ ì´ ë¹ ë¥´ê²Œ ë³€í•˜ê³  ìˆìœ¼ë©´ ì¶©ë¶„íˆ ì„±ìˆ™ë˜ì§€ ì•Šì•˜ìŒ</li> </ul> </li> </ul> <ol> <li> <p>ë°ë¸Œì˜µìŠ¤ê°€ íŠ¹íˆ â€˜<strong>ì•¼í¬ í„¸ ê¹ê¸°</strong>â€™ì— ì·¨ì•½ The second reason is that DevOps seems to be particularly susceptible to yak shaving - <a href="https://www.lesstif.com/software-engineering/yak-shaving-29590364.html">ë§í¬</a></p> <p><a href="https://everydayconcepts.io/yak-shaving/">https://everydayconcepts.io/yak-shaving/</a></p> <ul> <li>ì•¼í¬ í„¸ ê¹ê¸° : <strong>ì–´ë–¤ ëª©ì ì„ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì›ë˜ ëª©ì ê³¼ ì „í˜€ ìƒê´€ì—†ëŠ” ì¼ë“¤ì„ ê³„ì†í•´ì•¼ í•˜ë©° ê·¸ì¤‘ ë§ˆì§€ë§‰ ì‘ì—…</strong> - ğŸ‘ğŸ»Â <a href="https://www.lesstif.com/software-engineering/yak-shaving-29590364.html">ë§í¬</a></li> </ul> </li> <li> <p>ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì˜ <strong>ì²´í¬ ë¦¬ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ë§ë‹¤</strong> long checklist of tasks that you must do to prepare infrastructure for production</p> <ul> <li>ë¬¸ì œëŠ” ëŒ€ë‹¤ìˆ˜ ê°œë°œìê°€ ì²´í¬ ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” ëŒ€ë¶€ë¶„ì˜ í•­ëª©ì„ ì•Œì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ë¥¼ í‰ê°€í•  ë•Œ ì¤‘ìš”í•˜ê³  ì‹œê°„ì´ ë§ì´ ê±¸ë¦¬ëŠ” ì„¸ë¶€ ì‚¬í•­ì„ ìŠì–´ë²„ë¦°ë‹¤</li> </ul> </li> </ol> <h3 id="2-í”„ë¡œë•ì…˜-ìˆ˜ì¤€-ì¸í”„ë¼-ì²´í¬-ë¦¬ìŠ¤íŠ¸">2. í”„ë¡œë•ì…˜ ìˆ˜ì¤€ ì¸í”„ë¼ ì²´í¬ ë¦¬ìŠ¤íŠ¸</h3> <aside> â“ í”„ë¡œë•ì…˜ í™˜ê²½ìœ¼ë¡œ ì „í™˜í•˜ëŠ” ë° í•„ìš”í•œ ê²ƒì´ ë­ê°€ ìˆì£ ? What are the requirements for going to production? </aside> <p><strong>The Production-Grade Infrastructure Checklist</strong></p> <p><img src="https://miro.medium.com/max/1400/1*-nYI19LZZKDQjdAx0qhlFw.webp" alt="" /></p> <ul> <li>ì˜ˆë¥¼ ë“¤ì–´ ì„œë²„ë‚˜ ë¡œë“œë°¸ëŸ°ì„œê°€ ë‹¤ìš´ë˜ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? ë°ì´í„° ì„¼í„°ì— ë¬¸ì œê°€ ìƒê¸´ë‹¤ë©´?</li> <li>ë„¤íŠ¸ì›Œí‚¹ ì‘ì—… ì—­ì‹œ ê¹Œë‹¤ë¡­ë‹¤. â€˜VPC, VPN, Service Discovery, SSH Accessâ€™ ì„¤ì • ë“± ëª¨ë‘ ë§» ê°œì›”ì´ ê±¸ë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</li> <li>ê·¸ëŸ¬ë‚˜ í”„ë¡œì íŠ¸ ê³„íšê³¼ ì‹œê°„ ì˜ˆì¸¡ì—ì„œ ì™„ì „íˆ ë°°ì œë˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.</li> </ul> <h3 id="3-í”„ë¡œë•ì…˜-ìˆ˜ì¤€-ì¸í”„ë¼-ëª¨ë“ˆ">3. í”„ë¡œë•ì…˜ ìˆ˜ì¤€ ì¸í”„ë¼ ëª¨ë“ˆ</h3> <p><strong>Production-Grade Infrastructure Modules</strong></p> <p>ì‘ì—… ëª©ë¡ì„ í™•ì¸í–ˆìœ¼ë‹ˆ, êµ¬í˜„í•˜ê¸° ìœ„í•´ <strong>ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“ˆ</strong>ì„ êµ¬ì¶•í•˜ëŠ” <strong>ëª¨ë²” ì‚¬ë¡€</strong>ë¥¼ ì‚´í‘œë³´ì. ì•„ë˜ ë‹¤ë£° ì£¼ì œ.</p> <ul> <li><strong>ì†Œí˜• ëª¨ë“ˆ</strong> Small modules</li> <li><strong>í•©ì„± ê°€ëŠ¥í•œ ëª¨ë“ˆ</strong> Composable modules</li> <li><strong>í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ëª¨ë“ˆ</strong> Testable modules</li> <li><strong>ë¦´ë¦¬ìŠ¤ ê°€ëŠ¥í•œ ëª¨ë“ˆ</strong> Versioned modules</li> <li><strong>í…Œë¼í¼ ëª¨ë“ˆ ì™¸ì˜ ê²ƒë“¤</strong> Beyond Terraform modules</li> </ul> <p><strong>3.1 ì†Œí˜• ëª¨ë“ˆ Small modules</strong></p> <p><strong>ëŒ€í˜• ëª¨ë“ˆ ë‹¨ì </strong> : ìƒíƒœ íŒŒì¼ ê²©ë¦¬ì—ì„œ ì•Œì•„ë³¸ ê²ƒì²˜ëŸ¼ â€˜ê°œë°œ-ìŠ¤í…Œì´ì§•-í”„ë¡œë•ì…˜â€™ ëª¨ë“  ì¸í”„ë¼ í™˜ê²½ì„ ë‹¨ì¼ íŒŒì¼ ë˜ëŠ” ë‹¨ì¼ ëª¨ë“ˆë¡œ ì •ì˜í•˜ëŠ” ê²ƒì„ ì¢‹ì§€ ì•Šì„ë¿ë”ëŸ¬ <strong>ìœ í•´</strong>í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•¨</p> <ul> <li>ì†ë„ê°€ ëŠë¦¼ slow : ëª¨ë“  ì¸í”„ë¼ê°€ í•˜ë‚˜ì˜ ëª¨ë“ˆì— ì •ì˜ë˜ì–´ ìˆìœ¼ë©´ ëª…ë ¹ ì‹¤í–‰ ì‹œ ì˜¤ë˜ ê±¸ë¦¼. terraform plan ì‹œ 20ë¶„ ê±¸ë¦¬ê¸°ë„ í•¨</li> <li>ì•ˆì „í•˜ì§€ ì•ŠìŒ insecure : ëª¨ë“  ì¸í”„ë¼ê°€ í•˜ë‚˜ì˜ ëª¨ë“ˆì— ì •ì˜ë˜ì–´ ìˆìœ¼ë©´ ì–´ë–¤ ê²ƒì„ ë³€ê²½í•˜ë ¤ë©´ ëª¨ë“  ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ í•„ìš”í•¨. <ul> <li>ë”°ë¼ì„œ ëª¨ë“  ì‚¬ìš©ìê°€ ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•˜ì—¬ ìµœì†Œ ê¶Œí•œ ì›ì¹™ principle of least privilege ì— ìœ„ë°°</li> </ul> </li> <li>ìœ„í—˜ì„±ì´ ë†’ìŒ risky : ì˜ˆë¥¼ ë“¤ì–´ ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œ í”„ëŸ°íŠ¸ì—”ë“œ ì•±ì„ ë³€ê²½ ì‹œ ì˜¤íƒ€ë‚˜ ì˜ëª»ëœ ëª…ë ¹ìœ¼ë¡œ í”„ë¡œë•ì…˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆë‹¤</li> <li>ì´í•´í•˜ê¸° ì–´ë ¤ì›€ understand : í•œ ê³³ì— ì½”ë“œê°€ ë§ì„ìˆ˜ë¡ í•œ ì‚¬ëŒì´ ëª¨ë“  ê²ƒì„ ì´í•´í•˜ê¸°ê°€ ë” ì–´ë ¤ì›Œì§.</li> <li>ë¦¬ë·°í•˜ê¸° ì–´ë ¤ì›€ review : ìˆ˜ì§‘ ì¤„ì˜ ì½”ë“œë¡œ êµ¬ì„±ëœ ëª¨ë“ˆì„ ë¦¬ë·°í•˜ëŠ” ê²ƒìœ¼ ì‰½ì§€ë§Œ, ìˆ˜ì²œ ì¤„ì˜ ì½”ë“œë¡œ êµ¬ì„±ëœ ëª¨ë“ˆì„ ë¦¬ë·°í•˜ëŠ” ê²ƒì€ ê±°ì˜ ë¶ˆê°€ëŠ¥í•˜ë‹¤. <ul> <li>terraform plan ì‹¤í–‰ ì‹œ ì˜¤ë˜ ê±°ë¦¬ê³ , plan ëª…ë ¹ì˜ ì¶œë ¥ì´ ìˆ˜ì²œ ì¤„ì´ë©° ì•„ë¬´ë„ ì½”ë“œë¥¼ ì½ìœ¼ë ¤ í•˜ì§€ ì•ŠëŠ”ë‹¤.</li> <li>ì´ ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‚­ì œë  ê²ƒì„ì„ ë‚˜íƒ€ë‚´ëŠ” ë¹¨ê°„ìƒ‰ ì½”ë“œë¥¼ ëˆ„êµ¬ë„ ë°œê²¬í•˜ì§€ ëª»í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</li> </ul> </li> <li>í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ì›€ test : ì¸í”„ë¼ ì½”ë“œ í…ŒìŠ¤íŠ¸ëŠ” ì–´ë µë‹¤. ë‹¤ìŒ ì¥ì—ì„œ ì‚´í´ë³¼ ì˜ˆì •</li> </ul> <p><strong>ë°©ì•ˆ</strong> : <strong>ì†Œí˜• ëª¨ë“ˆ</strong>ë¡œ ì½”ë“œë¥¼ ì‘ì„±, í´ë¦° ì½”ë“œ Clean Code ë‚´ìš©</p> <ul> <li>í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ê·œì¹™ì€ ì‘ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. The first rule of functions is that they should be small.</li> <li> <p>í•¨ìˆ˜ì˜ ë‘ ë²ˆì§¸ ê·œì¹™ì€ ê·¸ë³´ë‹¤ ë” ì‘ì•„ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. The second rule of functions is that they should be smaller than that.</p> </li> <li>ìœ„ ì•„í‚¤í…ì²˜ë¼ 2ë§Œ ì¤„ì˜ ê±°ëŒ€í•œ ë‹¨ì¼ í…Œë¼í¼ ëª¨ë“ˆë¡œ ì •ì˜ë˜ì—ˆë‹¤ë©´, ì¦‰ì‹œ <strong>ì½”ë“œ ìŠ¤ë©œ</strong> code smell ë¡œ ì·¨ê¸‰í•´ì•¼ í•©ë‹ˆë‹¤. <ul> <li>ì½”ë“œ ìŠ¤ë©œ : ë” í° ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆëŠ” ì½”ë“œì˜ íŠ¹ì§• â†’ SonarQube ì†”ë£¨ì…˜ í™œìš© í•  ìˆ˜ ìˆìŒ - <a href="https://docs.sonarqube.org/latest/user-guide/concepts/">ë§í¬</a></li> </ul> </li> <li>ì•„ë˜ ì²˜ëŸ¼ ì—¬ëŸ¬ ê°œì˜ ì‘ì€ ëª¨ë“ˆë¡œ ë¦¬íŒ©í„°ë§í•˜ì : <strong>ASG, ALB, App â†’ ì½”ë“œë¥¼ ì†Œí˜• ëª¨ë“ˆ 3ê°œë¡œ ë¦¬íŒ©í„°ë§</strong></li> </ul> <p><strong>Letâ€™s refactor the code accordingly into three smaller modules:</strong></p> <ol> <li><strong>modules/cluster/asg-rolling-deploy</strong> : A generic, reusable, standalone module for deploying an ASG that can do a zero-downtime, rolling deployment. <ul> <li>ë¬´ì¤‘ë‹¨ ë¡¤ë§ ë°°í¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©° ASGë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì¼ë°˜ ë…ë¦½í˜• ëª¨ë“ˆ</li> </ul> </li> <li><strong>modules/networking/alb</strong> : A generic, reusable, standalone module for deploying an ALB. <ul> <li>ALBë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì¼ë°˜ ë…ë¦½í˜• ëª¨ë“ˆ</li> </ul> </li> <li><strong>modules/services/hello-world-app</strong> : A module specifically for deploying the â€œHello, Worldâ€ app, which uses the asg-rolling-deploy and alb modules under the hood. <ul> <li>â€œHello, Worldâ€ ì•±ì„ ë°°í¬í•˜ê¸° ìœ„í•œ ëª¨ë“ˆ</li> </ul> </li> </ol> <p><strong>ì½”ë“œ ë¦¬íŒ©í„°ë§</strong></p> <ol> <li>5ì¥ì—ì„œ ë°°í¬í•œ webserver-cluster ë¥¼ terraform destroy ë¡œ ì‚­ì œ â†’ asg-rolling-deploy ê³¼ alb ëª¨ë“ˆì„ ì¡°ë¦½í•  ìˆ˜ ìˆë‹¤</li> <li>[asg-rolling-deploy ë¦¬íŒ©í„°ë§] modules/cluster/asg-rolling-deploy ìƒˆ í´ë”ë¥¼ ë§Œë“¤ê³  module/services/webserver-cluster/main.tf â‡’ modules/cluster/<strong>asg-rolling-deploy/main.tf</strong> ë¡œ ë¦¬ì†ŒìŠ¤ ì´ë™ í›„ ìˆ˜ì • <ul> <li> <p>small-modules/modules/cluster/<strong>asg-rolling-deploy/main.tf</strong> - <a href="https://github.com/brikis98/terraform-up-and-running-code/blob/master/code/terraform/08-production-grade-infrastructure/small-modules/modules/cluster/asg-rolling-deploy/main.tf">ë§í¬</a></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  terraform <span class="o">{</span>
    required_version <span class="o">=</span> <span class="s2">"&gt;= 1.0.0, &lt; 2.0.0"</span>
        
    required_providers <span class="o">{</span>
      aws <span class="o">=</span> <span class="o">{</span>
        <span class="nb">source</span>  <span class="o">=</span> <span class="s2">"hashicorp/aws"</span>
        version <span class="o">=</span> <span class="s2">"~&gt; 4.0"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  resource <span class="s2">"aws_launch_configuration"</span> <span class="s2">"example"</span> <span class="o">{</span>
    image_id        <span class="o">=</span> var.ami
    instance_type   <span class="o">=</span> var.instance_type
    security_groups <span class="o">=</span> <span class="o">[</span>aws_security_group.instance.id]
    user_data       <span class="o">=</span> var.user_data
        
    <span class="c"># Required when using a launch configuration with an auto scaling group.</span>
    lifecycle <span class="o">{</span>
      create_before_destroy <span class="o">=</span> <span class="nb">true
      </span>precondition <span class="o">{</span>
        condition     <span class="o">=</span> data.aws_ec2_instance_type.instance.free_tier_eligible
        error_message <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="p">.instance_type</span><span class="k">}</span><span class="s2"> is not part of the AWS Free Tier!"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  resource <span class="s2">"aws_autoscaling_group"</span> <span class="s2">"example"</span> <span class="o">{</span>
    name                 <span class="o">=</span> var.cluster_name
    launch_configuration <span class="o">=</span> aws_launch_configuration.example.name
        
    vpc_zone_identifier  <span class="o">=</span> var.subnet_ids
        
    <span class="c"># Configure integrations with a load balancer</span>
    target_group_arns    <span class="o">=</span> var.target_group_arns
    health_check_type    <span class="o">=</span> var.health_check_type
        
    min_size <span class="o">=</span> var.min_size
    max_size <span class="o">=</span> var.max_size
        
    <span class="c"># Use instance refresh to roll out changes to the ASG</span>
    instance_refresh <span class="o">{</span>
      strategy <span class="o">=</span> <span class="s2">"Rolling"</span>
      preferences <span class="o">{</span>
        min_healthy_percentage <span class="o">=</span> 50
      <span class="o">}</span>
    <span class="o">}</span>
        
    tag <span class="o">{</span>
      key                 <span class="o">=</span> <span class="s2">"Name"</span>
      value               <span class="o">=</span> var.cluster_name
      propagate_at_launch <span class="o">=</span> <span class="nb">true</span>
    <span class="o">}</span>
        
    dynamic <span class="s2">"tag"</span> <span class="o">{</span>
      for_each <span class="o">=</span> <span class="o">{</span>
        <span class="k">for </span>key, value <span class="k">in </span>var.custom_tags:
        key <span class="o">=&gt;</span> upper<span class="o">(</span>value<span class="o">)</span>
        <span class="k">if </span>key <span class="o">!=</span> <span class="s2">"Name"</span>
      <span class="o">}</span>
        
      content <span class="o">{</span>
        key                 <span class="o">=</span> tag.key
        value               <span class="o">=</span> tag.value
        propagate_at_launch <span class="o">=</span> <span class="nb">true</span>
      <span class="o">}</span>
    <span class="o">}</span>
        
    lifecycle <span class="o">{</span>
      postcondition <span class="o">{</span>
        condition     <span class="o">=</span> length<span class="o">(</span>self.availability_zones<span class="o">)</span> <span class="o">&gt;</span> 1
        error_message <span class="o">=</span> <span class="s2">"You must use more than one AZ for high availability!"</span>
      <span class="o">}</span>
    <span class="o">}</span>
        
  <span class="o">}</span>
        
  resource <span class="s2">"aws_autoscaling_schedule"</span> <span class="s2">"scale_out_during_business_hours"</span> <span class="o">{</span>
    count <span class="o">=</span> var.enable_autoscaling ? 1 : 0
        
    scheduled_action_name  <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="p">.cluster_name</span><span class="k">}</span><span class="s2">-scale-out-during-business-hours"</span>
    min_size               <span class="o">=</span> 2
    max_size               <span class="o">=</span> 10
    desired_capacity       <span class="o">=</span> 10
    recurrence             <span class="o">=</span> <span class="s2">"0 9 * * *"</span>
    autoscaling_group_name <span class="o">=</span> aws_autoscaling_group.example.name
  <span class="o">}</span>
        
  resource <span class="s2">"aws_autoscaling_schedule"</span> <span class="s2">"scale_in_at_night"</span> <span class="o">{</span>
    count <span class="o">=</span> var.enable_autoscaling ? 1 : 0
        
    scheduled_action_name  <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="p">.cluster_name</span><span class="k">}</span><span class="s2">-scale-in-at-night"</span>
    min_size               <span class="o">=</span> 2
    max_size               <span class="o">=</span> 10
    desired_capacity       <span class="o">=</span> 2
    recurrence             <span class="o">=</span> <span class="s2">"0 17 * * *"</span>
    autoscaling_group_name <span class="o">=</span> aws_autoscaling_group.example.name
  <span class="o">}</span>
        
  resource <span class="s2">"aws_security_group"</span> <span class="s2">"instance"</span> <span class="o">{</span>
    name <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="p">.cluster_name</span><span class="k">}</span><span class="s2">-instance"</span>
  <span class="o">}</span>
        
  resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"allow_server_http_inbound"</span> <span class="o">{</span>
    <span class="nb">type</span>              <span class="o">=</span> <span class="s2">"ingress"</span>
    security_group_id <span class="o">=</span> aws_security_group.instance.id
        
    from_port   <span class="o">=</span> var.server_port
    to_port     <span class="o">=</span> var.server_port
    protocol    <span class="o">=</span> local.tcp_protocol
    cidr_blocks <span class="o">=</span> local.all_ips
  <span class="o">}</span>
        
  resource <span class="s2">"aws_cloudwatch_metric_alarm"</span> <span class="s2">"high_cpu_utilization"</span> <span class="o">{</span>
    alarm_name  <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="p">.cluster_name</span><span class="k">}</span><span class="s2">-high-cpu-utilization"</span>
    namespace   <span class="o">=</span> <span class="s2">"AWS/EC2"</span>
    metric_name <span class="o">=</span> <span class="s2">"CPUUtilization"</span>
        
    dimensions <span class="o">=</span> <span class="o">{</span>
      AutoScalingGroupName <span class="o">=</span> aws_autoscaling_group.example.name
    <span class="o">}</span>
        
    comparison_operator <span class="o">=</span> <span class="s2">"GreaterThanThreshold"</span>
    evaluation_periods  <span class="o">=</span> 1
    period              <span class="o">=</span> 300
    statistic           <span class="o">=</span> <span class="s2">"Average"</span>
    threshold           <span class="o">=</span> 90
    unit                <span class="o">=</span> <span class="s2">"Percent"</span>
  <span class="o">}</span>
        
  resource <span class="s2">"aws_cloudwatch_metric_alarm"</span> <span class="s2">"low_cpu_credit_balance"</span> <span class="o">{</span>
    count <span class="o">=</span> format<span class="o">(</span><span class="s2">"%.1s"</span>, var.instance_type<span class="o">)</span> <span class="o">==</span> <span class="s2">"t"</span> ? 1 : 0
        
    alarm_name  <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="p">.cluster_name</span><span class="k">}</span><span class="s2">-low-cpu-credit-balance"</span>
    namespace   <span class="o">=</span> <span class="s2">"AWS/EC2"</span>
    metric_name <span class="o">=</span> <span class="s2">"CPUCreditBalance"</span>
        
    dimensions <span class="o">=</span> <span class="o">{</span>
      AutoScalingGroupName <span class="o">=</span> aws_autoscaling_group.example.name
    <span class="o">}</span>
        
    comparison_operator <span class="o">=</span> <span class="s2">"LessThanThreshold"</span>
    evaluation_periods  <span class="o">=</span> 1
    period              <span class="o">=</span> 300
    statistic           <span class="o">=</span> <span class="s2">"Minimum"</span>
    threshold           <span class="o">=</span> 10
    unit                <span class="o">=</span> <span class="s2">"Count"</span>
  <span class="o">}</span>
        
  data <span class="s2">"aws_ec2_instance_type"</span> <span class="s2">"instance"</span> <span class="o">{</span>
    instance_type <span class="o">=</span> var.instance_type
  <span class="o">}</span>
        
  locals <span class="o">{</span>
    tcp_protocol <span class="o">=</span> <span class="s2">"tcp"</span>
    all_ips      <span class="o">=</span> <span class="o">[</span><span class="s2">"0.0.0.0/0"</span><span class="o">]</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> <li>[asg-rolling-deploy ë¦¬íŒ©í„°ë§] ì´ì œ ë³€ìˆ˜ë¥¼ module/services/webserver-cluster/variables.tf â‡’ modules/cluster/<strong>asg-rolling-deploy/variables.tf</strong> ë¡œ ì´ë™ <ul> <li> <p>small-modules/modules/cluster/<strong>asg-rolling-deploy/variables.tf</strong> - <a href="https://github.com/brikis98/terraform-up-and-running-code/blob/master/code/terraform/08-production-grade-infrastructure/small-modules/modules/cluster/asg-rolling-deploy/variables.tf">ë§í¬</a></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
  <span class="c"># REQUIRED PARAMETERS</span>
  <span class="c"># You must provide a value for each of these parameters.</span>
  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
        
  variable <span class="s2">"cluster_name"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The name to use for all the cluster resources"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
  <span class="o">}</span>
        
  variable <span class="s2">"ami"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The AMI to run in the cluster"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
  <span class="o">}</span>
        
  variable <span class="s2">"instance_type"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The type of EC2 Instances to run (e.g. t2.micro)"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> contains<span class="o">([</span><span class="s2">"t2.micro"</span>, <span class="s2">"t3.micro"</span><span class="o">]</span>, var.instance_type<span class="o">)</span>
      error_message <span class="o">=</span> <span class="s2">"Only free tier is allowed: t2.micro | t3.micro."</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"min_size"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The minimum number of EC2 Instances in the ASG"</span>
    <span class="nb">type</span>        <span class="o">=</span> number
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> var.min_size <span class="o">&gt;</span> 0
      error_message <span class="o">=</span> <span class="s2">"ASGs can't be empty or we'll have an outage!"</span>
    <span class="o">}</span>
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> var.min_size &lt;<span class="o">=</span> 10
      error_message <span class="o">=</span> <span class="s2">"ASGs must have 10 or fewer instances to keep costs down."</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"max_size"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The maximum number of EC2 Instances in the ASG"</span>
    <span class="nb">type</span>        <span class="o">=</span> number
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> var.max_size <span class="o">&gt;</span> 0
      error_message <span class="o">=</span> <span class="s2">"ASGs can't be empty or we'll have an outage!"</span>
    <span class="o">}</span>
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> var.max_size &lt;<span class="o">=</span> 10
      error_message <span class="o">=</span> <span class="s2">"ASGs must have 10 or fewer instances to keep costs down."</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"subnet_ids"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The subnet IDs to deploy to"</span>
    <span class="nb">type</span>        <span class="o">=</span> list<span class="o">(</span>string<span class="o">)</span>
  <span class="o">}</span>
        
  variable <span class="s2">"enable_autoscaling"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"If set to true, enable auto scaling"</span>
    <span class="nb">type</span>        <span class="o">=</span> bool
  <span class="o">}</span>
        
  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
  <span class="c"># OPTIONAL PARAMETERS</span>
  <span class="c"># These parameters have reasonable defaults.</span>
  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
        
  variable <span class="s2">"target_group_arns"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The ARNs of ELB target groups in which to register Instances"</span>
    <span class="nb">type</span>        <span class="o">=</span> list<span class="o">(</span>string<span class="o">)</span>
    default     <span class="o">=</span> <span class="o">[]</span>
  <span class="o">}</span>
        
  variable <span class="s2">"health_check_type"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The type of health check to perform. Must be one of: EC2, ELB."</span>
    <span class="nb">type</span>        <span class="o">=</span> string
    default     <span class="o">=</span> <span class="s2">"EC2"</span>
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> contains<span class="o">([</span><span class="s2">"EC2"</span>, <span class="s2">"ELB"</span><span class="o">]</span>, var.health_check_type<span class="o">)</span>
      error_message <span class="o">=</span> <span class="s2">"The health_check_type must be one of: EC2 | ELB."</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"user_data"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The User Data script to run in each Instance at boot"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
    default     <span class="o">=</span> null
  <span class="o">}</span>
        
  variable <span class="s2">"custom_tags"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"Custom tags to set on the Instances in the ASG"</span>
    <span class="nb">type</span>        <span class="o">=</span> map<span class="o">(</span>string<span class="o">)</span>
    default     <span class="o">=</span> <span class="o">{}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"server_port"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The port the server will use for HTTP requests"</span>
    <span class="nb">type</span>        <span class="o">=</span> number
    default     <span class="o">=</span> 8080
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> <li>[alb ë¦¬íŒ©í„°ë§] modules/networking/alb ìƒˆ í´ë” ë§Œë“¤ê³ , module/services/webserver-cluster/main.tf â‡’ modules/networking/<strong>alb/main.tf</strong> ë¡œ ë¦¬ì†ŒìŠ¤ ì´ë™ í›„ ìˆ˜ì • <ul> <li> <p>small-modules/modules/networking/<strong>alb/main.tf</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  terraform <span class="o">{</span>
    required_version <span class="o">=</span> <span class="s2">"&gt;= 1.0.0, &lt; 2.0.0"</span>
        
    required_providers <span class="o">{</span>
      aws <span class="o">=</span> <span class="o">{</span>
        <span class="nb">source</span>  <span class="o">=</span> <span class="s2">"hashicorp/aws"</span>
        version <span class="o">=</span> <span class="s2">"~&gt; 4.0"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  resource <span class="s2">"aws_lb"</span> <span class="s2">"example"</span> <span class="o">{</span>
    name               <span class="o">=</span> var.alb_name
    load_balancer_type <span class="o">=</span> <span class="s2">"application"</span>
        
    subnets            <span class="o">=</span> var.subnet_ids
        
    security_groups    <span class="o">=</span> <span class="o">[</span>aws_security_group.alb.id]
  <span class="o">}</span>
        
  resource <span class="s2">"aws_lb_listener"</span> <span class="s2">"http"</span> <span class="o">{</span>
    load_balancer_arn <span class="o">=</span> aws_lb.example.arn
    port              <span class="o">=</span> local.http_port
    protocol          <span class="o">=</span> <span class="s2">"HTTP"</span>
        
    <span class="c"># By default, return a simple 404 page</span>
    default_action <span class="o">{</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="s2">"fixed-response"</span>
        
      fixed_response <span class="o">{</span>
        content_type <span class="o">=</span> <span class="s2">"text/plain"</span>
        message_body <span class="o">=</span> <span class="s2">"404: page not found"</span>
        status_code  <span class="o">=</span> 404
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  resource <span class="s2">"aws_security_group"</span> <span class="s2">"alb"</span> <span class="o">{</span>
    name <span class="o">=</span> var.alb_name
  <span class="o">}</span>
        
  resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"allow_http_inbound"</span> <span class="o">{</span>
    <span class="nb">type</span>              <span class="o">=</span> <span class="s2">"ingress"</span>
    security_group_id <span class="o">=</span> aws_security_group.alb.id
        
    from_port   <span class="o">=</span> local.http_port
    to_port     <span class="o">=</span> local.http_port
    protocol    <span class="o">=</span> local.tcp_protocol
    cidr_blocks <span class="o">=</span> local.all_ips
  <span class="o">}</span>
        
  resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"allow_all_outbound"</span> <span class="o">{</span>
    <span class="nb">type</span>              <span class="o">=</span> <span class="s2">"egress"</span>
    security_group_id <span class="o">=</span> aws_security_group.alb.id
        
    from_port   <span class="o">=</span> local.any_port
    to_port     <span class="o">=</span> local.any_port
    protocol    <span class="o">=</span> local.any_protocol
    cidr_blocks <span class="o">=</span> local.all_ips
  <span class="o">}</span>
        
  locals <span class="o">{</span>
    http_port    <span class="o">=</span> 80
    any_port     <span class="o">=</span> 0
    any_protocol <span class="o">=</span> <span class="s2">"-1"</span>
    tcp_protocol <span class="o">=</span> <span class="s2">"tcp"</span>
    all_ips      <span class="o">=</span> <span class="o">[</span><span class="s2">"0.0.0.0/0"</span><span class="o">]</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> <li>[alb ë¦¬íŒ©í„°ë§] ì´ì œ ë³€ìˆ˜ ì½”ë“œ íŒŒì¼ ìƒì„± modules/networking/<strong>alb/variables.tf</strong> <ul> <li> <p>small-modules/modules/networking/<strong>alb/variables.tf</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
  <span class="c"># REQUIRED PARAMETERS</span>
  <span class="c"># You must provide a value for each of these parameters.</span>
  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
        
  variable <span class="s2">"alb_name"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The name to use for this ALB"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
  <span class="o">}</span>
        
  variable <span class="s2">"subnet_ids"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The subnet IDs to deploy to"</span>
    <span class="nb">type</span>        <span class="o">=</span> list<span class="o">(</span>string<span class="o">)</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> </ol> <p><strong>3.2 í•©ì„± ê°€ëŠ¥í•œ ëª¨ë“ˆ</strong> Composable modules</p> <p><strong>ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ê³  í•©ì„± ê°€ëŠ¥í•œ ëª¨ë“ˆ</strong></p> <ul> <li><strong>ì™¸ë¶€ì—ì„œ ìƒíƒœë¥¼ ì½ëŠ” ëŒ€ì‹  ì…ë ¥ ë§¤ê°œ ë³€ìˆ˜ë¥¼ í†µí•´ ì „ë‹¬í•˜ê³ , ì™¸ë¶€ì— ìƒíƒœë¥¼ ì“°ëŠ” ëŒ€ì‹  ì¶œë ¥ ë§¤ê°œ ë³€ìˆ˜ë¥¼ í†µí•´ ê³„ì‚° ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</strong></li> <li>ëª¨ë“  ê²ƒì„ ì…ë ¥ ë³€ìˆ˜ë¥¼ í†µí•´ ì „ë‹¬í•˜ê³  ëª¨ë“  ê²ƒì„ ì¶œë ¥ ë³€ìˆ˜ë¥¼ í†µí•´ ë°˜í™˜í•˜ë©° ê°„ë‹¨í•œ ëª¨ë“ˆë“¤ì„ ê²°í•©í•´ ë” ë³µì¡í•œ ëª¨ë“ˆì„ ë§Œë“¤ìˆ˜ ìˆë‹¤.</li> <li>ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” ë” ë‚˜ì€ í•©ì„±ê³¼ ì¬ì‚¬ìš©ì„ ìœ„í•´ ì•„ë˜ ì‹¤ìŠµ ë‚´ìš© ë³´ë‹¤ ëª¨ë“ˆì„ ë”ìš± ì„¸ë¶„í™”í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</li> </ul> <p><strong>ì½”ë“œ ë¦¬íŒ©í„°ë§</strong></p> <ol> <li>modules/cluster/<strong>asg-rolling-deploy/variables.tf</strong> ì— ìƒˆë¡œìš´ ì…ë ¥ ë³€ìˆ˜ 4ê°œë¥¼ ì¶”ê°€ <ul> <li> <p>small-modules/modules/cluster/<strong>asg-rolling-deploy/variables.tf</strong> - <a href="https://github.com/brikis98/terraform-up-and-running-code/blob/master/code/terraform/08-production-grade-infrastructure/small-modules/modules/cluster/asg-rolling-deploy/variables.tf">ë§í¬</a></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
  <span class="c"># REQUIRED PARAMETERS</span>
  <span class="c"># You must provide a value for each of these parameters.</span>
  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
        
  variable <span class="s2">"cluster_name"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The name to use for all the cluster resources"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
  <span class="o">}</span>
        
  variable <span class="s2">"ami"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The AMI to run in the cluster"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
  <span class="o">}</span>
        
  variable <span class="s2">"instance_type"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The type of EC2 Instances to run (e.g. t2.micro)"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> contains<span class="o">([</span><span class="s2">"t2.micro"</span>, <span class="s2">"t3.micro"</span><span class="o">]</span>, var.instance_type<span class="o">)</span>
      error_message <span class="o">=</span> <span class="s2">"Only free tier is allowed: t2.micro | t3.micro."</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"min_size"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The minimum number of EC2 Instances in the ASG"</span>
    <span class="nb">type</span>        <span class="o">=</span> number
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> var.min_size <span class="o">&gt;</span> 0
      error_message <span class="o">=</span> <span class="s2">"ASGs can't be empty or we'll have an outage!"</span>
    <span class="o">}</span>
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> var.min_size &lt;<span class="o">=</span> 10
      error_message <span class="o">=</span> <span class="s2">"ASGs must have 10 or fewer instances to keep costs down."</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"max_size"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The maximum number of EC2 Instances in the ASG"</span>
    <span class="nb">type</span>        <span class="o">=</span> number
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> var.max_size <span class="o">&gt;</span> 0
      error_message <span class="o">=</span> <span class="s2">"ASGs can't be empty or we'll have an outage!"</span>
    <span class="o">}</span>
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> var.max_size &lt;<span class="o">=</span> 10
      error_message <span class="o">=</span> <span class="s2">"ASGs must have 10 or fewer instances to keep costs down."</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"subnet_ids"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The subnet IDs to deploy to"</span>
    <span class="nb">type</span>        <span class="o">=</span> list<span class="o">(</span>string<span class="o">)</span>
  <span class="o">}</span>
        
  variable <span class="s2">"enable_autoscaling"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"If set to true, enable auto scaling"</span>
    <span class="nb">type</span>        <span class="o">=</span> bool
  <span class="o">}</span>
        
  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
  <span class="c"># OPTIONAL PARAMETERS</span>
  <span class="c"># These parameters have reasonable defaults.</span>
  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
        
  variable <span class="s2">"target_group_arns"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The ARNs of ELB target groups in which to register Instances"</span>
    <span class="nb">type</span>        <span class="o">=</span> list<span class="o">(</span>string<span class="o">)</span>
    default     <span class="o">=</span> <span class="o">[]</span>
  <span class="o">}</span>
        
  variable <span class="s2">"health_check_type"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The type of health check to perform. Must be one of: EC2, ELB."</span>
    <span class="nb">type</span>        <span class="o">=</span> string
    default     <span class="o">=</span> <span class="s2">"EC2"</span>
        
    validation <span class="o">{</span>
      condition     <span class="o">=</span> contains<span class="o">([</span><span class="s2">"EC2"</span>, <span class="s2">"ELB"</span><span class="o">]</span>, var.health_check_type<span class="o">)</span>
      error_message <span class="o">=</span> <span class="s2">"The health_check_type must be one of: EC2 | ELB."</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"user_data"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The User Data script to run in each Instance at boot"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
    default     <span class="o">=</span> null
  <span class="o">}</span>
        
  variable <span class="s2">"custom_tags"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"Custom tags to set on the Instances in the ASG"</span>
    <span class="nb">type</span>        <span class="o">=</span> map<span class="o">(</span>string<span class="o">)</span>
    default     <span class="o">=</span> <span class="o">{}</span>
  <span class="o">}</span>
        
  variable <span class="s2">"server_port"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The port the server will use for HTTP requests"</span>
    <span class="nb">type</span>        <span class="o">=</span> number
    default     <span class="o">=</span> 8080
  <span class="o">}</span>
</code></pre></div> </div> </li> <li><strong>subnet_ids ëŠ” asg-rolling-deploy ëª¨ë“ˆì„ ë°°í¬í•  ì„œë¸Œë„·ì„ ì§€ì •</strong> <ul> <li><strong>webserver-cluster ëª¨ë“ˆ(5ì¥)</strong>ì€ ê¸°ë³¸ VPC ë° ê¸°ë³¸ ì„œë¸Œë„·ì— ë°°í¬ë˜ë„ë¡ <strong>í•˜ë“œ ì½”ë”©</strong>ë˜ì–´ ìˆì§€ë§Œ, subnet_ids ë³€ìˆ˜ë¥¼ ë…¸ì¶œí•´ ì–´ë–¤ VPCë‚˜ ì„œë¸Œë„·ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í—ˆìš©</li> </ul> </li> <li><strong>target_group_arns ê³¼ health_check_type ë³€ìˆ˜ëŠ” ASGë¥¼ ë¡œë“œ ë°¸ëŸ°ì„œì™€ í†µí•©í•˜ëŠ” ë°©ì‹ì„ êµ¬ì„±</strong> <ul> <li>webserver-cluster ëª¨ë“ˆì—ëŠ” ALBê°€ ë‚´ì¥ë˜ì–´ ìˆì§€ë§Œ asg-rolling-deploy ëª¨ë“ˆì€ ì¼ë°˜ ëª¨ë“ˆì´ë¯€ë¡œ ë¡œë“œ ë°¸ëŸ°ì„œ ì„¤ì •ì„ ì…ë ¥ ë³€ìˆ˜ë¡œ ë…¸ì¶œí•˜ë©´ ë‹¤ì–‘í•œ ìƒí™©ì—ì„œ ASGë¥¼ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.</li> <li>ì˜ˆë¥¼ ë“¤ì–´ ë¡œë“œ ë°¸ëŸ°ì„œê°€ ì—†ê±°ë‚˜ í•˜ë‚˜ì˜ ALB ë˜ëŠ” ì—¬ëŸ¬ NLBë¥¼ ì‚¬ìš©í•˜ëŠ” ìƒí™©ì—ì„œ ASGë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ</li> </ul> </li> <li>ìœ„ 3ê°€ì§€ ì…ë ¥ ë³€ìˆ˜ë¥¼ module/services/webserver-cluster/main.tf â‡’ modules/cluster/<strong>asg-rolling-deploy/main.tf</strong>ì˜ aws_autoscaling_group ë¦¬ì†ŒìŠ¤ì— ì „ë‹¬í•˜ì—¬ ALBì™€ ê°™ì€ ì´ì „ì— í•˜ë“œ ì½”ë”©ëœ ë¦¬ì†ŒìŠ¤ ë° ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” ì„¤ì •ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤. <ul> <li> <p>small-modules/modules/cluster/<strong>asg-rolling-deploy/main.tf</strong> - <a href="https://github.com/brikis98/terraform-up-and-running-code/blob/master/code/terraform/08-production-grade-infrastructure/small-modules/modules/cluster/asg-rolling-deploy/main.tf">ë§í¬</a></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ...
  resource <span class="s2">"aws_autoscaling_group"</span> <span class="s2">"example"</span> <span class="o">{</span>
    name                 <span class="o">=</span> var.cluster_name
    launch_configuration <span class="o">=</span> aws_launch_configuration.example.name
            
    vpc_zone_identifier  <span class="o">=</span> var.subnet_ids
            
    <span class="k">**</span><span class="c"># Configure integrations with a load balancer</span>
    target_group_arns    <span class="o">=</span> var.target_group_arns
    health_check_type    <span class="o">=</span> var.health_check_type<span class="k">**</span>
            
    min_size <span class="o">=</span> var.min_size
    max_size <span class="o">=</span> var.max_size
            
    <span class="c"># Use instance refresh to roll out changes to the ASG</span>
    instance_refresh <span class="o">{</span>
      strategy <span class="o">=</span> <span class="s2">"Rolling"</span>
      preferences <span class="o">{</span>
        min_healthy_percentage <span class="o">=</span> 50
      <span class="o">}</span>
    <span class="o">}</span>
            
    tag <span class="o">{</span>
      key                 <span class="o">=</span> <span class="s2">"Name"</span>
      value               <span class="o">=</span> var.cluster_name
      propagate_at_launch <span class="o">=</span> <span class="nb">true</span>
    <span class="o">}</span>
            
    dynamic <span class="s2">"tag"</span> <span class="o">{</span>
      for_each <span class="o">=</span> <span class="o">{</span>
        <span class="k">for </span>key, value <span class="k">in </span>var.custom_tags:
        key <span class="o">=&gt;</span> upper<span class="o">(</span>value<span class="o">)</span>
        <span class="k">if </span>key <span class="o">!=</span> <span class="s2">"Name"</span>
      <span class="o">}</span>
            
      content <span class="o">{</span>
        key                 <span class="o">=</span> tag.key
        value               <span class="o">=</span> tag.value
        propagate_at_launch <span class="o">=</span> <span class="nb">true</span>
      <span class="o">}</span>
    <span class="o">}</span>
            
    lifecycle <span class="o">{</span>
      postcondition <span class="o">{</span>
        condition     <span class="o">=</span> length<span class="o">(</span>self.availability_zones<span class="o">)</span> <span class="o">&gt;</span> 1
        error_message <span class="o">=</span> <span class="s2">"You must use more than one AZ for high availability!"</span>
      <span class="o">}</span>
    <span class="o">}</span>
            
  <span class="o">}</span>
  ...
</code></pre></div> </div> </li> </ul> </li> <li><strong>user_data ëŠ” ì‚¬ìš©ì ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì „ë‹¬</strong> <ul> <li>webserver-cluster ëª¨ë“ˆì— í•˜ë“œ ì½”ë”©ëœ ì‚¬ìš©ì ë°ì´í„° ìŠ¤í¬ë¦½í¬ëŠ” â€˜<strong>Hello, Worldâ€™</strong> ì•± ë°°í¬ì—ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li> <li>ê·¸ëŸ¬ë‚˜ ì‚¬ìš©ì ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì…ë ¥ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ë©´ asg-rolling-deploy ëª¨ë“ˆì€ ASG ì „ì²´ì— ì–´ë–¤ ì•±ì´ë“  ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li> <li>ì´ user_data ë³€ìˆ˜ë¥¼ ì•„ë˜ aws_launch_configuration ë¦¬ì†ŒìŠ¤ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.</li> <li> <p>small-modules/modules/cluster/<strong>asg-rolling-deploy/main.tf</strong> - <a href="https://github.com/brikis98/terraform-up-and-running-code/blob/master/code/terraform/08-production-grade-infrastructure/small-modules/modules/cluster/asg-rolling-deploy/main.tf">ë§í¬</a></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ...
  resource <span class="s2">"aws_launch_configuration"</span> <span class="s2">"example"</span> <span class="o">{</span>
    image_id        <span class="o">=</span> var.ami
    instance_type   <span class="o">=</span> var.instance_type
    security_groups <span class="o">=</span> <span class="o">[</span>aws_security_group.instance.id]
    user_data       <span class="o">=</span> var.user_data
            
    <span class="c"># Required when using a launch configuration with an auto scaling group.</span>
    lifecycle <span class="o">{</span>
      create_before_destroy <span class="o">=</span> <span class="nb">true
      </span>precondition <span class="o">{</span>
        condition     <span class="o">=</span> data.aws_ec2_instance_type.instance.free_tier_eligible
        error_message <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="p">.instance_type</span><span class="k">}</span><span class="s2"> is not part of the AWS Free Tier!"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  ...
</code></pre></div> </div> </li> </ul> </li> </ul> </li> <li>ì¶œë ¥ ë³€ìˆ˜ ì¶”ê°€ <ul> <li>ì•„ë˜ ì¶œë ¥ ë³€ìˆ˜ 2ê°œë¥¼ ì¶”ê°€ : ì•„ë˜ ì¶œë ¥ì„ ì‚¬ìš©í•˜ì—¬ ë³´ì•ˆ ê·¸ë£¹ì— ì‚¬ìš©ì ì •ì˜ ê·œì¹™ì„ ì¶”ê°€í•˜ëŠ” ë“± ìƒˆë¡œìš´ ë™ì‘ì„ ì¶”ê°€í• ìˆ˜ ìˆì–´ì„œ asg-rolling-deploy ëª¨ë“ˆì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì„ <ul> <li> <p>small-modules/modules/cluster/<strong>asg-rolling-deploy/outputs.tf</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  output <span class="s2">"**asg_name**"</span> <span class="o">{</span>
    value       <span class="o">=</span> aws_autoscaling_group.example.name
    description <span class="o">=</span> <span class="s2">"The name of the Auto Scaling Group"</span>
  <span class="o">}</span>
            
  output <span class="s2">"instance_security_group_id"</span> <span class="o">{</span>
    value       <span class="o">=</span> aws_security_group.instance.id
    description <span class="o">=</span> <span class="s2">"The ID of the EC2 Instance Security Group"</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> <li>ë¹„ìŠ·í•˜ê²Œ modules/networking/<strong>alb/outputs.tf</strong> ì—ë„ ì¶œë ¥ ë³€ìˆ˜ë¥¼ ì¶”ê°€ <ul> <li> <p>small-modules/modules/networking/<strong>alb/outputs.tf</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  output <span class="s2">"alb_dns_name"</span> <span class="o">{</span>
    value       <span class="o">=</span> aws_lb.example.dns_name
    description <span class="o">=</span> <span class="s2">"The domain name of the load balancer"</span>
  <span class="o">}</span>
            
  output <span class="s2">"alb_http_listener_arn"</span> <span class="o">{</span>
    value       <span class="o">=</span> aws_lb_listener.http.arn
    description <span class="o">=</span> <span class="s2">"The ARN of the HTTP listener"</span>
  <span class="o">}</span>
            
  output <span class="s2">"alb_security_group_id"</span> <span class="o">{</span>
    value       <span class="o">=</span> aws_security_group.alb.id
    description <span class="o">=</span> <span class="s2">"The ALB Security Group ID"</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> </ul> </li> <li>[ë§ˆì§€ë§‰ ë‹¨ê³„] asg-rolling-deploy ë° alb ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ webserver-cluster ëª¨ë“ˆì„ â€˜Hello, Worldâ€™ ì•±ì„ ë°°í¬í•  ìˆ˜ ìˆëŠ” <strong>hello-world-app ëª¨ë“ˆ</strong>ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒ <ul> <li>ì´ë¥¼ ìœ„í•´ module/services/webserver-cluster ì´ë¦„ì„ â†’ module/services/hello-world-app ë¡œ ë³€ê²½</li> <li>ì•„ë˜ ë¦¬ì†ŒìŠ¤ì™€ ë°ì´í„° ì†ŒìŠ¤ë§Œ ë‚¨ê²¨ ë‘ì <ul> <li> <p>module/services/hello-world-app/main.tf</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ...
  module <span class="s2">"asg"</span> <span class="o">{</span>
    <span class="nb">source</span> <span class="o">=</span> <span class="s2">"../../cluster/asg-rolling-deploy"</span>
            
    cluster_name  <span class="o">=</span> <span class="s2">"hello-world-</span><span class="k">${</span><span class="nv">var</span><span class="p">.environment</span><span class="k">}</span><span class="s2">"</span>
    ami           <span class="o">=</span> var.ami
    instance_type <span class="o">=</span> var.instance_type
            
    user_data     <span class="o">=</span> templatefile<span class="o">(</span><span class="s2">"</span><span class="k">${</span><span class="nv">path</span><span class="p">.module</span><span class="k">}</span><span class="s2">/user-data.sh"</span>, <span class="o">{</span>
      server_port <span class="o">=</span> var.server_port
      db_address  <span class="o">=</span> data.terraform_remote_state.db.outputs.address
      db_port     <span class="o">=</span> data.terraform_remote_state.db.outputs.port
      server_text <span class="o">=</span> var.server_text
    <span class="o">})</span>
            
    min_size           <span class="o">=</span> var.min_size
    max_size           <span class="o">=</span> var.max_size
    enable_autoscaling <span class="o">=</span> var.enable_autoscaling
            
    subnet_ids        <span class="o">=</span> data.aws_subnets.default.ids
    target_group_arns <span class="o">=</span> <span class="o">[</span>aws_lb_target_group.asg.arn]
    health_check_type <span class="o">=</span> <span class="s2">"ELB"</span>
              
    custom_tags <span class="o">=</span> var.custom_tags
  <span class="o">}</span>
            
  module <span class="s2">"alb"</span> <span class="o">{</span>
    <span class="nb">source</span> <span class="o">=</span> <span class="s2">"../../networking/alb"</span>
            
    alb_name   <span class="o">=</span> <span class="s2">"hello-world-</span><span class="k">${</span><span class="nv">var</span><span class="p">.environment</span><span class="k">}</span><span class="s2">"</span>
    subnet_ids <span class="o">=</span> data.aws_subnets.default.ids
  <span class="o">}</span>
            
  resource <span class="s2">"aws_lb_target_group"</span> <span class="s2">"asg"</span> <span class="o">{</span>
    name     <span class="o">=</span> <span class="s2">"hello-world-</span><span class="k">${</span><span class="nv">var</span><span class="p">.environment</span><span class="k">}</span><span class="s2">"</span>
    port     <span class="o">=</span> var.server_port
    protocol <span class="o">=</span> <span class="s2">"HTTP"</span>
    vpc_id   <span class="o">=</span> data.aws_vpc.default.id
            
    health_check <span class="o">{</span>
      path                <span class="o">=</span> <span class="s2">"/"</span>
      protocol            <span class="o">=</span> <span class="s2">"HTTP"</span>
      matcher             <span class="o">=</span> <span class="s2">"200"</span>
      interval            <span class="o">=</span> 15
      <span class="nb">timeout</span>             <span class="o">=</span> 3
      healthy_threshold   <span class="o">=</span> 2
      unhealthy_threshold <span class="o">=</span> 2
    <span class="o">}</span>
  <span class="o">}</span>
            
  resource <span class="s2">"aws_lb_listener_rule"</span> <span class="s2">"asg"</span> <span class="o">{</span>
    listener_arn <span class="o">=</span> module.alb.alb_http_listener_arn
    priority     <span class="o">=</span> 100
            
    condition <span class="o">{</span>
      path_pattern <span class="o">{</span>
        values <span class="o">=</span> <span class="o">[</span><span class="s2">"*"</span><span class="o">]</span>
      <span class="o">}</span>
    <span class="o">}</span>
            
    action <span class="o">{</span>
      <span class="nb">type</span>             <span class="o">=</span> <span class="s2">"forward"</span>
      target_group_arn <span class="o">=</span> aws_lb_target_group.asg.arn
    <span class="o">}</span>
  <span class="o">}</span>
            
  data <span class="s2">"terraform_remote_state"</span> <span class="s2">"db"</span> <span class="o">{</span>
    backend <span class="o">=</span> <span class="s2">"s3"</span>
            
    config <span class="o">=</span> <span class="o">{</span>
      bucket <span class="o">=</span> var.db_remote_state_bucket
      key    <span class="o">=</span> var.db_remote_state_key
      region <span class="o">=</span> <span class="s2">"us-east-2"</span>
    <span class="o">}</span>
  <span class="o">}</span>
            
  data <span class="s2">"aws_vpc"</span> <span class="s2">"default"</span> <span class="o">{</span>
    default <span class="o">=</span> <span class="nb">true</span>
  <span class="o">}</span>
            
  data <span class="s2">"aws_subnets"</span> <span class="s2">"default"</span> <span class="o">{</span>
    filter <span class="o">{</span>
      name   <span class="o">=</span> <span class="s2">"vpc-id"</span>
      values <span class="o">=</span> <span class="o">[</span>data.aws_vpc.default.id]
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> <li>modules/services/hello-world-app/variables.tf ì— ì•„ë˜ ë³€ìˆ˜ë¥¼ ì¶”ê°€ <ul> <li> <p>modules/services/hello-world-app/variables.tf</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
  <span class="c"># REQUIRED PARAMETERS</span>
  <span class="c"># You must provide a value for each of these parameters.</span>
  <span class="c"># ---------------------------------------------------------------------------------------------------------------------</span>
            
  variable <span class="s2">"environment"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The name of the environment we're deploying to"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
  <span class="o">}</span>
  ...
</code></pre></div> </div> </li> </ul> </li> <li>ê·¸ë¦¬ê³  ì´ì „ì— ì‘ì„±í•œ asg-rolling-deploy ëª¨ë“ˆì„ hello-world-app ëª¨ë“ˆì— ì¶”ê°€í•©ë‹ˆë‹¤</li> <li>ê·¸ë¦¬ê³  ì´ì „ì— ìƒì„±í•œ alb ëª¨ë“ˆì„ hello-world-app ëª¨ë“ˆì— ì¶”ê°€í•©ë‹ˆë‹¤</li> <li>environment ì…ë ¥ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•´ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ hello-world-stage, hello-world-prod ê°™ì€ í™˜ê²½ì„ ê¸°ì¤€ìœ¼ë¡œ ì§€ì •ë˜ë„ë¡ ëª…ëª… ê·œì¹™ì„ ì‹œí–‰í•©ë‹ˆë‹¤.</li> <li>ì´ ì½”ë“œëŠ” ë˜í•œ ì´ì „ì— ì¶”ê°€í•œ ìƒˆë¡œìš´ subnet_ids, target_group_arns, health_check_type, and user_data ë³€ìˆ˜ë¥¼ ì ì ˆí•œ ê°’ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</li> <li>ë‹¤ìŒìœ¼ë¡œ ì´ ì•±ì— ëŒ€í•œ ALB ëŒ€ìƒ ê·¸ë£¹ ë° ë¦¬ìŠ¤ë„ˆ ê·œì¹™ì„ êµ¬ì„±í•©ë‹ˆë‹¤.</li> <li>name ì—ì„œ environment ë¥¼ ì‚¬ìš©í•˜ë„ë¡ module/services/hello-world-app/main.tfì—ì„œ aws_lb_target_group ë¦¬ì†ŒìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. <ul> <li> <p>module/services/hello-world-app/main.tf</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ...
  resource <span class="s2">"aws_lb_target_group"</span> <span class="s2">"asg"</span> <span class="o">{</span>
    name     <span class="o">=</span> <span class="s2">"hello-world-</span><span class="k">${</span><span class="nv">var</span><span class="p">.environment</span><span class="k">}</span><span class="s2">"</span>
    port     <span class="o">=</span> var.server_port
    protocol <span class="o">=</span> <span class="s2">"HTTP"</span>
    vpc_id   <span class="o">=</span> data.aws_vpc.default.id
            
    health_check <span class="o">{</span>
      path                <span class="o">=</span> <span class="s2">"/"</span>
      protocol            <span class="o">=</span> <span class="s2">"HTTP"</span>
      matcher             <span class="o">=</span> <span class="s2">"200"</span>
      interval            <span class="o">=</span> 15
      <span class="nb">timeout</span>             <span class="o">=</span> 3
      healthy_threshold   <span class="o">=</span> 2
      unhealthy_threshold <span class="o">=</span> 2
    <span class="o">}</span>
  <span class="o">}</span>
  ...
</code></pre></div> </div> </li> </ul> </li> <li>ì´ì œ aws_lb_listener_rule ë¦¬ì†ŒìŠ¤ì˜ listener_arn ë§¤ê°œ ë³€ìˆ˜ê°€ ALB ëª¨ë“ˆì˜ alb_http_listener_arn ì¶œë ¥ì„ ê°€ë¦¬í‚¤ë„ë¡ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. <ul> <li> <p>module/services/hello-world-app/main.tf</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ...
            
  resource <span class="s2">"aws_lb_listener_rule"</span> <span class="s2">"asg"</span> <span class="o">{</span>
    listener_arn <span class="o">=</span> module.alb.alb_http_listener_arn
    priority     <span class="o">=</span> 100
            
    condition <span class="o">{</span>
      path_pattern <span class="o">{</span>
        values <span class="o">=</span> <span class="o">[</span><span class="s2">"*"</span><span class="o">]</span>
      <span class="o">}</span>
    <span class="o">}</span>
            
    action <span class="o">{</span>
      <span class="nb">type</span>             <span class="o">=</span> <span class="s2">"forward"</span>
      target_group_arn <span class="o">=</span> aws_lb_target_group.asg.arn
    <span class="o">}</span>
  <span class="o">}</span>
  ...
</code></pre></div> </div> </li> </ul> </li> <li>ë§ˆì§€ë§‰ìœ¼ë¡œ asg-rolling-deploy ë° alb ëª¨ë“ˆì˜ ì¤‘ìš”í•œ ì¶œë ¥ì„ hello-world-app ëª¨ë“ˆì˜ ì¶œë ¥ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. <ul> <li> <p>module/services/hello-world-app/outputs.tf</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  output <span class="s2">"alb_dns_name"</span> <span class="o">{</span>
    value       <span class="o">=</span> module.alb.alb_dns_name
    description <span class="o">=</span> <span class="s2">"The domain name of the load balancer"</span>
  <span class="o">}</span>
            
  output <span class="s2">"asg_name"</span> <span class="o">{</span>
    value       <span class="o">=</span> module.asg.asg_name
    description <span class="o">=</span> <span class="s2">"The name of the Auto Scaling Group"</span>
  <span class="o">}</span>
            
  output <span class="s2">"instance_security_group_id"</span> <span class="o">{</span>
    value       <span class="o">=</span> module.asg.instance_security_group_id
    description <span class="o">=</span> <span class="s2">"The ID of the EC2 Instance Security Group"</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> </ul> </li> </ol> <p><strong>3.3 í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ëª¨ë“ˆ</strong> Testable modules</p> <p><strong>ìœ„ì—ì„œ ì‘ì„±í•œ ì½”ë“œ ì‘ë™ í™•ì¸ ì‹¤ìŠµ</strong></p> <ol> <li>examples/asg/main.tf ì‘ì„± : asg-rolling-deploy ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ í¬ê¸°ê°€ 1ì¸ ASGë¥¼ ë°°í¬ <ul> <li> <p>examples/asg/main.tf</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  terraform <span class="o">{</span>
    required_version <span class="o">=</span> <span class="s2">"&gt;= 1.0.0, &lt; 2.0.0"</span>
        
    required_providers <span class="o">{</span>
      aws <span class="o">=</span> <span class="o">{</span>
        <span class="nb">source</span>  <span class="o">=</span> <span class="s2">"hashicorp/aws"</span>
        version <span class="o">=</span> <span class="s2">"~&gt; 4.0"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
        
  provider <span class="s2">"aws"</span> <span class="o">{</span>
    region <span class="o">=</span> <span class="s2">"us-east-2"</span>
  <span class="o">}</span>
        
  module <span class="s2">"asg"</span> <span class="o">{</span>
    <span class="nb">source</span> <span class="o">=</span> <span class="s2">"../../modules/cluster/asg-rolling-deploy"</span>
        
    cluster_name  <span class="o">=</span> var.cluster_name
        
    ami           <span class="o">=</span> data.aws_ami.ubuntu.id
    instance_type <span class="o">=</span> <span class="s2">"t2.micro"</span>
        
    min_size           <span class="o">=</span> 1
    max_size           <span class="o">=</span> 1
    enable_autoscaling <span class="o">=</span> <span class="nb">false
        
    </span>subnet_ids        <span class="o">=</span> data.aws_subnets.default.ids
  <span class="o">}</span>
        
  data <span class="s2">"aws_vpc"</span> <span class="s2">"default"</span> <span class="o">{</span>
    default <span class="o">=</span> <span class="nb">true</span>
  <span class="o">}</span>
        
  data <span class="s2">"aws_subnets"</span> <span class="s2">"default"</span> <span class="o">{</span>
    filter <span class="o">{</span>
      name   <span class="o">=</span> <span class="s2">"vpc-id"</span>
      values <span class="o">=</span> <span class="o">[</span>data.aws_vpc.default.id]
    <span class="o">}</span>
  <span class="o">}</span>
        
  data <span class="s2">"aws_ami"</span> <span class="s2">"ubuntu"</span> <span class="o">{</span>
    most_recent <span class="o">=</span> <span class="nb">true
    </span>owners      <span class="o">=</span> <span class="o">[</span><span class="s2">"099720109477"</span><span class="o">]</span> <span class="c"># Canonical</span>
        
    filter <span class="o">{</span>
      name   <span class="o">=</span> <span class="s2">"name"</span>
      values <span class="o">=</span> <span class="o">[</span><span class="s2">"ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*"</span><span class="o">]</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> </li> <li> <p>ë°°í¬ ë° í™•ì¸</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c"># [í„°ë¯¸ë„1] RDS ìƒì„± ëª¨ë‹ˆí„°ë§</span>
 <span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do</span> <span class="k">**</span>aws rds describe-db-instances<span class="k">**</span> <span class="nt">--query</span> <span class="s2">"*[].[Endpoint.Address,Endpoint.Port,MasterUsername]"</span> <span class="nt">--output</span> text  <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"------------------------------"</span> <span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="k">done</span>
    
 <span class="c"># RDS ë°°í¬</span>
 <span class="nb">cd</span> ~/terraform-up-and-running-code/code/terraform/08-production-grade-infrastructure/small-modules/examples/<span class="k">**</span>mysql<span class="k">**</span>
    
 <span class="c"># í™˜ê²½ë³€ìˆ˜ì— ì§€ì •</span>
 <span class="nb">export </span><span class="nv">TF_VAR_db_username</span><span class="o">=</span><span class="s1">'cloudneta'</span>
 <span class="nb">export </span><span class="nv">TF_VAR_db_password</span><span class="o">=</span><span class="s1">'cloudnetaQ!'</span>
    
 terraform init <span class="o">&amp;&amp;</span> terraform plan
 terraform apply <span class="nt">-auto-approve</span>
    
 <span class="c"># [í„°ë¯¸ë„2]</span>
 <span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>aws ec2 describe-instances <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"------------------------------"</span> <span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="k">done</span>
    
 <span class="c"># ë°°í¬</span>
 <span class="nb">cd</span> ~/terraform-up-and-running-code/code/terraform/08-production-grade-infrastructure/small-modules/examples/<span class="k">**</span>asg<span class="k">**</span>
 terraform init
 terraform plan
 terraform apply <span class="nt">-auto-approve</span>
    
 <span class="c"># ALB ë°°í¬</span>
 <span class="nb">cd</span> ~/terraform-up-and-running-code/code/terraform/08-production-grade-infrastructure/small-modules/examples/<span class="k">**</span>alb<span class="k">**</span>
 terraform init <span class="o">&amp;&amp;</span> terraform plan
 terraform apply <span class="nt">-auto-approve</span>
    
 <span class="c"># ALB DNSì£¼ì†Œë¡œ curl ì ‘ì† í™•ì¸ </span>
 <span class="nv">ALBDNS</span><span class="o">=</span><span class="si">$(</span>terraform output <span class="nt">-raw</span> alb_dns_name<span class="si">)</span>
 <span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">--connect-timeout</span> 1  http://<span class="nv">$ALBDNS</span> <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"------------------------------"</span><span class="p">;</span> <span class="nb">date</span><span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="k">done
 </span>curl <span class="nt">-s</span> http://<span class="nv">$ALBDNS</span>
</code></pre></div> </div> </li> <li> <p>ì‚­ì œ</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">cd</span> ~/terraform-up-and-running-code/code/terraform/08-production-grade-infrastructure/small-modules/examples/alb
 terraform destroy <span class="nt">-auto-approve</span>
 <span class="nb">cd</span> ~/terraform-up-and-running-code/code/terraform/08-production-grade-infrastructure/small-modules/examples/asg
 terraform destroy <span class="nt">-auto-approve</span>
 <span class="nb">cd</span> ~/terraform-up-and-running-code/code/terraform/08-production-grade-infrastructure/small-modules/examples/mysql
 terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div> </div> </li> </ol> <p><strong>3.4 ë¦´ë¦¬ìŠ¤ ê°€ëŠ¥í•œ ëª¨ë“ˆ</strong> Versioned modules</p> <p><strong>Validations</strong> : í…Œë¼í¼ 0.13 validation blocks ì€ ì…ë ¥ ë³€ìˆ˜ë¥¼ ì²´í¬</p> <ul> <li> <p>ì•„ë˜ëŠ” instance_type ìœ¼ë¡œ t2.micro ì™€ t3.micro ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì„¤ì •</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  variable <span class="s2">"instance_type"</span> <span class="o">{</span>
    description <span class="o">=</span> <span class="s2">"The type of EC2 Instances to run (e.g. t2.micro)"</span>
    <span class="nb">type</span>        <span class="o">=</span> string
    
    validation <span class="o">{</span>
      condition     <span class="o">=</span> contains<span class="o">([</span><span class="s2">"t2.micro"</span>, <span class="s2">"t3.micro"</span><span class="o">]</span>, var.instance_type<span class="o">)</span>
      error_message <span class="o">=</span> <span class="s2">"Only free tier is allowed: t2.micro | t3.micro."</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> <li> <p>ì²´í¬ ê²€ì¦ í™•ì¸</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>terraform apply <span class="nt">-var</span> <span class="nv">instance_type</span><span class="o">=</span><span class="s2">"m4.large"</span>
  â”‚ Error: Invalid value <span class="k">for </span>variable
  â”‚
  â”‚   on main.tf line 17:
  â”‚    1: variable <span class="s2">"instance_type"</span> <span class="o">{</span>
  â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”‚     â”‚ var.instance_type is <span class="s2">"m4.large"</span>
  â”‚
  â”‚ Only free tier is allowed: t2.micro | t3.micro.
  â”‚
  â”‚ This was checked by the validation rule at main.tf:21,3-13.
</code></pre></div> </div> </li> </ul> <p><strong>ë²„ì „ Versioned Modules : ì˜¤ëŠ˜ ì‹¤í–‰í•˜ë˜, 3ë…„ í›„ì— ì‹¤í–‰í•˜ë˜ ë™ì¼í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤!</strong></p> <ul> <li>ë‘ ê°€ì§€ ìœ í˜• ë²„ì „ ê³ ë ¤ : Versioning of the moduleâ€™s dependencies , Versioning of the module itself</li> <li><strong>Versioning of the moduleâ€™s dependencies</strong> : Terraform core, Providers, Modules <ul> <li>Terraform core : The version of the terraform binary you depend on â†’ <strong>í…Œë¼í¼ ì‹¤í–‰ íŒŒì¼ ë²„ì „</strong></li> <li>Providers : The version of each provider your code depends on, such as the aws provider â†’ <strong>í”„ë¡œë°”ì´ë” ë²„ì „</strong></li> <li>Modules : The version of each module you depend on that are pulled in via module blocks â†’ <strong>ëª¨ë“ˆ ë²„ì „</strong></li> </ul> </li> <li> <p><strong>Terraform core ê³ ì •</strong> : required_version ì‚¬ìš©</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  terraform <span class="o">{</span>
    <span class="c"># Require any 1.x version of Terraform</span>
    required_version <span class="o">=</span> <span class="s2">"&gt;= 1.0.0, &lt; 2.0.0"</span>
  <span class="o">}</span>
</code></pre></div> </div> <ul> <li>Production í™˜ê²½ì—ì„œëŠ” ë²„ì „ì„ ì§ì ‘ ì§€ì •ì„ ê¶Œì¥</li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  terraform <span class="o">{</span>
    <span class="c"># Require Terraform at exactly version 1.2.3</span>
    required_version <span class="o">=</span> <span class="s2">"1.2.3"</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> <li> <p><strong>Providers ê³ ì •</strong> : required_providers ì•„ë˜ version ì‚¬ìš©</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  terraform <span class="o">{</span>
    required_version <span class="o">=</span> <span class="s2">"&gt;= 1.0.0, &lt; 2.0.0"</span>
    
    required_providers <span class="o">{</span>
      aws <span class="o">=</span> <span class="o">{</span>
        <span class="nb">source</span>  <span class="o">=</span> <span class="s2">"hashicorp/aws"</span>
        version <span class="o">=</span> <span class="s2">"~&gt; 4.0"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> <li><strong>Modules ê³ ì •</strong> : ì‹œë§¨í‹± ë²„ì „ ê´€ë¦¬ì™€ í•¨ê»˜ ê¹ƒ íƒœê·¸ë¥¼ ì‚¬ìš©</li> </ul> <p><strong>3.5 í…Œë¼í¼ ëª¨ë“ˆ ì™¸ì˜ ê²ƒë“¤</strong> Beyond Terraform modules</p> <ul> <li>Provisioners</li> <li>Provisioners with null_resource</li> <li>External data source</li> </ul> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://lahuman.github.io/tags/#terraform" title="Pages tagged terraform" class="tag"><span class="term">terraform</span></a><a href="https://lahuman.github.io/tags/#study" title="Pages tagged study" class="tag"><span class="term">study</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://lahuman.github.io/t101_7week_2/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://lahuman.github.io/t101_7week_2/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://lahuman.github.io/t101_7week_2/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-ubp67fs9s850" data-ad-width = "320" data-ad-height = "100"></ins> <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://lahuman.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://lahuman.github.io/assets/js/scripts.js"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74095083-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-74095083-1'); </script> <script type="text/javascript"> var disqus_shortname = 'daniels-blog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
