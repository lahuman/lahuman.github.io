<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Nginx Ingress Controller - Custom Errors &#8211; lahuman</title> <meta name="description" content="열심히 사는 아저씨"> <meta name="keywords" content="kang, ingress, errorpage"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://lahuman.github.io/assets/img/logo.png"> <meta name="twitter:title" content="Nginx Ingress Controller - Custom Errors"> <meta name="twitter:description" content="Kubernetes Advanced Networking Study"> <!-- Open Graph --> <meta property="og:locale" content="ko_KR"> <meta property="og:type" content="article"> <meta property="og:title" content="Nginx Ingress Controller - Custom Errors"> <meta property="og:description" content="Kubernetes Advanced Networking Study"> <meta property="og:url" content="https://lahuman.github.io/kang_last_mission/"> <meta property="og:site_name" content="lahuman"> <meta property="og:image" content="https://lahuman.github.io/assets/img/logo.png"> <link rel="canonical" href="https://lahuman.github.io/kang_last_mission/"> <link href="https://lahuman.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="lahuman Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://lahuman.github.io/assets/css/main.css"> <!-- JS --> <script src="https://lahuman.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://lahuman.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://lahuman.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://lahuman.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://lahuman.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://lahuman.github.io/favicon.png" /> <link rel="shortcut icon" href="https://lahuman.github.io/favicon.ico" /> <!-- mermaid --> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script>mermaid.initialize({startOnLoad:true});</script> <!-- Background Image --> <style type="text/css">body {background-image:url(https://lahuman.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://lahuman.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://lahuman.github.io/assets/img/logo.png" alt="lahuman photo" class="author-photo"> <h4>lahuman</h4> <p>열심히 사는 아저씨</p> </li> <li><a href="https://lahuman.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://facebook.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://linkedin.com/in/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://lahuman.github.io/posts/">All Posts</a></li> <li><a href="https://lahuman.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://lahuman.github.io/projects/" >Projects</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Nginx Ingress Controller - Custom Errors</h1> <h4>05 Mar 2022</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~10 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://lahuman.github.io/projects/"> <i class="fa fa-chevron-left"></i> </a> </div> <h1 id="nginx-ingress-controller---custom-errors">Nginx Ingress Controller - Custom Errors</h1> <blockquote> <p>KANG 스터디에서 졸업 과제로 무엇을 해야 하는지 도전 과제를 확인 중 <a href="https://kubernetes.github.io/ingress-nginx/examples/customization/custom-errors/">Custom Errors</a>를 보았습니다. 어렵지 않게 그리고 많이 사용될 것으로 생각되어서 도전해보게 되었습니다.</p> </blockquote> <p>시작하기에 앞서서 <a href="https://lahuman.github.io/kang_6week/">#6 Ingress</a>를 먼저 읽어주세요.</p> <h2 id="사용자-정의-오류-페이지란">사용자 정의 오류 페이지란?</h2> <p>백엔드를 사용 중 오류 발생시 만약 <code class="language-plaintext highlighter-rouge">Ingress Controller에 정의된 Error</code>라면, <code class="language-plaintext highlighter-rouge">사용자 정의 오류 페이지</code>를 보여주는 기능입니다.</p> <h2 id="사용자-정의-기본-백엔드-설정">사용자 정의 기본 백엔드 설정</h2> <p>먼저 사용자 정의 <code class="language-plaintext highlighter-rouge">default-backend-service</code>를 설정합니다. 이것은 나중에 Ingress 컨트롤러에서 사용됩니다.</p> <p>사용할 <code class="language-plaintext highlighter-rouge">default-baend-service</code>는 <a href="https://github.com/kenmoini/custom-nginx-ingress-errors">kenmoini/custom-nginx-ingress-errors</a> 로 <code class="language-plaintext highlighter-rouge">404</code>, <code class="language-plaintext highlighter-rouge">503</code>, <code class="language-plaintext highlighter-rouge">500</code> Error 페이지를 이쁘게 만들어 둔 이미지를 제공하고 있습니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/kenmoini/custom-nginx-ingress-errors
<span class="nv">$ </span><span class="nb">cd </span>custom-nginx-ingress-errors
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> k8s-deployment.yaml
service/nginx-errors created
deployment.apps/nginx-errors created
</code></pre></div></div> <h3 id="k8s-deploymentyaml-파일">k8s-deployment.yaml 파일</h3> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-errors</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">nginx-errors</span>
    <span class="na">app.kubernetes.io/part-of</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">nginx-errors</span>
    <span class="na">app.kubernetes.io/part-of</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-errors</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">nginx-errors</span>
    <span class="na">app.kubernetes.io/part-of</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">nginx-errors</span>
      <span class="na">app.kubernetes.io/part-of</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">nginx-errors</span>
        <span class="na">app.kubernetes.io/part-of</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-error-server</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">kenmoini/custom-nginx-ingress-errors:latest</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        <span class="c1"># Setting the environment variable DEBUG we can see the headers sent</span>
        <span class="c1"># by the ingress controller to the backend in the client response.</span>
        <span class="c1"># env:</span>
        <span class="c1"># - name: DEBUG</span>
        <span class="c1">#   value: "true"</span>
</code></pre></div></div> <h2 id="ingress-설정">ingress 설정</h2> <blockquote> <p>조금 긴 yaml 이지만, 기존 6주차에서 사용했던 ingress 설치 파일에서 2줄만 추가했습니다. 2가지는 default-backend-service와 custom-http-errors를 설정 합니다.</p> </blockquote> <p>추가된 내용의 요약은 아래와 같습니다.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>
<span class="c1"># Source: ingress-nginx/templates/controller-configmap.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>
  <span class="na">data</span><span class="pi">:</span>
    <span class="na">allow-snippet-annotations</span><span class="pi">:</span> <span class="s1">'</span><span class="s">true'</span>
    <span class="c1"># custom-http-errors 사용 설정 400, 500, 503 error일 경우 default backend servie를 사용</span>
    <span class="na">custom-http-errors</span><span class="pi">:</span> <span class="s2">"</span><span class="s">404,500,503"</span>
<span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>
<span class="c1"># Source: ingress-nginx/templates/controller-deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>
  <span class="na">spec</span><span class="pi">:</span>
      <span class="na">dnsPolicy</span><span class="pi">:</span> <span class="s">ClusterFirst</span>
      <span class="na">nodeName</span><span class="pi">:</span> <span class="s">k8s-m</span>
      <span class="na">containers</span><span class="pi">:</span>
<span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>
          <span class="na">args</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">/nginx-ingress-controller</span>
            <span class="pi">-</span> <span class="s">--publish-service=$(POD_NAMESPACE)/ingress-nginx-controller</span>
            <span class="c1"># --default-backend-service 값을 이전에 설치한 nginx-errors로 설정</span>
            <span class="pi">-</span> <span class="s">--default-backend-service=$(POD_NAMESPACE)/nginx-errors</span>
            <span class="pi">-</span> <span class="s">--election-id=ingress-controller-leader</span>
            <span class="pi">-</span> <span class="s">--controller-class=k8s.io/ingress-nginx</span>
            <span class="pi">-</span> <span class="s">--configmap=$(POD_NAMESPACE)/ingress-nginx-controller</span>
            <span class="pi">-</span> <span class="s">--validating-webhook=:8443</span>
            <span class="pi">-</span> <span class="s">--validating-webhook-certificate=/usr/local/certificates/cert</span>
            <span class="pi">-</span> <span class="s">--validating-webhook-key=/usr/local/certificates/key</span>
            <span class="pi">-</span> <span class="s">--v=3</span>
<span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>            
</code></pre></div></div> <h3 id="전체-nginx-ingressyaml">전체 nginx-ingress.yaml</h3> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>

<span class="nn">---</span>
<span class="c1"># 파일명 : nginx-ingress.yaml</span>
<span class="c1"># Source: ingress-nginx/templates/controller-serviceaccount.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">true</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/controller-configmap.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-controller</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">allow-snippet-annotations</span><span class="pi">:</span> <span class="s1">'</span><span class="s">true'</span>
  <span class="c1"># custom-http-errors 사용 설정 400, 500, 503 error일 경우 default backend servie를 사용</span>
  <span class="na">custom-http-errors</span><span class="pi">:</span> <span class="s2">"</span><span class="s">404,500,503"</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/clusterrole.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">configmaps</span>
      <span class="pi">-</span> <span class="s">endpoints</span>
      <span class="pi">-</span> <span class="s">nodes</span>
      <span class="pi">-</span> <span class="s">pods</span>
      <span class="pi">-</span> <span class="s">secrets</span>
      <span class="pi">-</span> <span class="s">namespaces</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">nodes</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">services</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">networking.k8s.io</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ingresses</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">events</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">create</span>
      <span class="pi">-</span> <span class="s">patch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">networking.k8s.io</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ingresses/status</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">update</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">networking.k8s.io</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ingressclasses</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/clusterrolebinding.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">subjects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/controller-role.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">namespaces</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">configmaps</span>
      <span class="pi">-</span> <span class="s">pods</span>
      <span class="pi">-</span> <span class="s">secrets</span>
      <span class="pi">-</span> <span class="s">endpoints</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">services</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">networking.k8s.io</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ingresses</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">networking.k8s.io</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ingresses/status</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">update</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">networking.k8s.io</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ingressclasses</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">configmaps</span>
    <span class="na">resourceNames</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ingress-controller-leader</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">update</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">configmaps</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">create</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">events</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">create</span>
      <span class="pi">-</span> <span class="s">patch</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/controller-rolebinding.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">subjects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/controller-service-webhook.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-controller-admission</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">https-webhook</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">443</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="s">webhook</span>
      <span class="na">appProtocol</span><span class="pi">:</span> <span class="s">https</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/controller-service.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">annotations</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-controller</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">externalTrafficPolicy</span><span class="pi">:</span> <span class="s">Local</span>
  <span class="na">ipFamilyPolicy</span><span class="pi">:</span> <span class="s">SingleStack</span>
  <span class="na">ipFamilies</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">IPv4</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="s">http</span>
      <span class="na">appProtocol</span><span class="pi">:</span> <span class="s">http</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">https</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">443</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="s">https</span>
      <span class="na">appProtocol</span><span class="pi">:</span> <span class="s">https</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/controller-deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-controller</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
      <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
      <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">minReadySeconds</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">dnsPolicy</span><span class="pi">:</span> <span class="s">ClusterFirst</span>
      <span class="na">nodeName</span><span class="pi">:</span> <span class="s">k8s-m</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">controller</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">k8s.gcr.io/ingress-nginx/controller:v1.1.1@sha256:0bc88eb15f9e7f84e8e56c14fa5735aaa488b840983f87bd79b1054190e660de</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">lifecycle</span><span class="pi">:</span>
            <span class="na">preStop</span><span class="pi">:</span>
              <span class="na">exec</span><span class="pi">:</span>
                <span class="na">command</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="s">/wait-shutdown</span>
          <span class="na">args</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">/nginx-ingress-controller</span>
            <span class="pi">-</span> <span class="s">--publish-service=$(POD_NAMESPACE)/ingress-nginx-controller</span>
            <span class="c1"># --default-backend-service 값을 이전에 설치한 nginx-errors로 설정</span>
            <span class="pi">-</span> <span class="s">--default-backend-service=$(POD_NAMESPACE)/nginx-errors</span>
            <span class="pi">-</span> <span class="s">--election-id=ingress-controller-leader</span>
            <span class="pi">-</span> <span class="s">--controller-class=k8s.io/ingress-nginx</span>
            <span class="pi">-</span> <span class="s">--configmap=$(POD_NAMESPACE)/ingress-nginx-controller</span>
            <span class="pi">-</span> <span class="s">--validating-webhook=:8443</span>
            <span class="pi">-</span> <span class="s">--validating-webhook-certificate=/usr/local/certificates/cert</span>
            <span class="pi">-</span> <span class="s">--validating-webhook-key=/usr/local/certificates/key</span>
            <span class="pi">-</span> <span class="s">--v=3</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="na">capabilities</span><span class="pi">:</span>
              <span class="na">drop</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">ALL</span>
              <span class="na">add</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">NET_BIND_SERVICE</span>
            <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">101</span>
            <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAME</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.name</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAMESPACE</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.namespace</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">LD_PRELOAD</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s">/usr/local/lib/libmimalloc.so</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">5</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/healthz</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">10254</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">10</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
            <span class="na">successThreshold</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">timeoutSeconds</span><span class="pi">:</span> <span class="m">1</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">3</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/healthz</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">10254</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">10</span>
            <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
            <span class="na">successThreshold</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">timeoutSeconds</span><span class="pi">:</span> <span class="m">1</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
              <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
              <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">https</span>
              <span class="na">containerPort</span><span class="pi">:</span> <span class="m">443</span>
              <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">webhook</span>
              <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8443</span>
              <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">webhook-cert</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/local/certificates/</span>
              <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">90Mi</span>
      <span class="na">nodeSelector</span><span class="pi">:</span>
        <span class="na">kubernetes.io/os</span><span class="pi">:</span> <span class="s">linux</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">webhook-cert</span>
          <span class="na">secret</span><span class="pi">:</span>
            <span class="na">secretName</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/controller-ingressclass.yaml</span>
<span class="c1"># We don't support namespaced ingressClass yet</span>
<span class="c1"># So a ClusterRole and a ClusterRoleBinding is required</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">IngressClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">controller</span><span class="pi">:</span> <span class="s">k8s.io/ingress-nginx</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/admission-webhooks/validating-webhook.yaml</span>
<span class="c1"># before changing this value, check the required kubernetes version</span>
<span class="c1"># https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#prerequisites</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">admissionregistration.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ValidatingWebhookConfiguration</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
<span class="na">webhooks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">validate.nginx.ingress.kubernetes.io</span>
    <span class="na">matchPolicy</span><span class="pi">:</span> <span class="s">Equivalent</span>
    <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">networking.k8s.io</span>
        <span class="na">apiVersions</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">v1</span>
        <span class="na">operations</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">CREATE</span>
          <span class="pi">-</span> <span class="s">UPDATE</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">ingresses</span>
    <span class="na">failurePolicy</span><span class="pi">:</span> <span class="s">Fail</span>
    <span class="na">sideEffects</span><span class="pi">:</span> <span class="s">None</span>
    <span class="na">admissionReviewVersions</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">v1</span>
    <span class="na">clientConfig</span><span class="pi">:</span>
      <span class="na">service</span><span class="pi">:</span>
        <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-controller-admission</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">/networking/v1/ingresses</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/admission-webhooks/job-patch/serviceaccount.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">helm.sh/hook</span><span class="pi">:</span> <span class="s">pre-install,pre-upgrade,post-install,post-upgrade</span>
    <span class="na">helm.sh/hook-delete-policy</span><span class="pi">:</span> <span class="s">before-hook-creation,hook-succeeded</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/admission-webhooks/job-patch/clusterrole.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">helm.sh/hook</span><span class="pi">:</span> <span class="s">pre-install,pre-upgrade,post-install,post-upgrade</span>
    <span class="na">helm.sh/hook-delete-policy</span><span class="pi">:</span> <span class="s">before-hook-creation,hook-succeeded</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">admissionregistration.k8s.io</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">validatingwebhookconfigurations</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">update</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/admission-webhooks/job-patch/clusterrolebinding.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">helm.sh/hook</span><span class="pi">:</span> <span class="s">pre-install,pre-upgrade,post-install,post-upgrade</span>
    <span class="na">helm.sh/hook-delete-policy</span><span class="pi">:</span> <span class="s">before-hook-creation,hook-succeeded</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
<span class="na">subjects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/admission-webhooks/job-patch/role.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">helm.sh/hook</span><span class="pi">:</span> <span class="s">pre-install,pre-upgrade,post-install,post-upgrade</span>
    <span class="na">helm.sh/hook-delete-policy</span><span class="pi">:</span> <span class="s">before-hook-creation,hook-succeeded</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">'</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">secrets</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">create</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/admission-webhooks/job-patch/rolebinding.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">helm.sh/hook</span><span class="pi">:</span> <span class="s">pre-install,pre-upgrade,post-install,post-upgrade</span>
    <span class="na">helm.sh/hook-delete-policy</span><span class="pi">:</span> <span class="s">before-hook-creation,hook-succeeded</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
<span class="na">subjects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/admission-webhooks/job-patch/job-createSecret.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">batch/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Job</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission-create</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">helm.sh/hook</span><span class="pi">:</span> <span class="s">pre-install,pre-upgrade</span>
    <span class="na">helm.sh/hook-delete-policy</span><span class="pi">:</span> <span class="s">before-hook-creation,hook-succeeded</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission-create</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
        <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
        <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
        <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">create</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">args</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">create</span>
            <span class="pi">-</span> <span class="s">--host=ingress-nginx-controller-admission,ingress-nginx-controller-admission.$(POD_NAMESPACE).svc</span>
            <span class="pi">-</span> <span class="s">--namespace=$(POD_NAMESPACE)</span>
            <span class="pi">-</span> <span class="s">--secret-name=ingress-nginx-admission</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAMESPACE</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.namespace</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">OnFailure</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
      <span class="na">nodeSelector</span><span class="pi">:</span>
        <span class="na">kubernetes.io/os</span><span class="pi">:</span> <span class="s">linux</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">2000</span>
<span class="nn">---</span>
<span class="c1"># Source: ingress-nginx/templates/admission-webhooks/job-patch/job-patchWebhook.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">batch/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Job</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission-patch</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">helm.sh/hook</span><span class="pi">:</span> <span class="s">post-install,post-upgrade</span>
    <span class="na">helm.sh/hook-delete-policy</span><span class="pi">:</span> <span class="s">before-hook-creation,hook-succeeded</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx-admission-patch</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.0.15</span>
        <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.1.1</span>
        <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
        <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">admission-webhook</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">patch</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">args</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">patch</span>
            <span class="pi">-</span> <span class="s">--webhook-name=ingress-nginx-admission</span>
            <span class="pi">-</span> <span class="s">--namespace=$(POD_NAMESPACE)</span>
            <span class="pi">-</span> <span class="s">--patch-mutating=false</span>
            <span class="pi">-</span> <span class="s">--secret-name=ingress-nginx-admission</span>
            <span class="pi">-</span> <span class="s">--patch-failure-policy=Fail</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAMESPACE</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.namespace</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">OnFailure</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">ingress-nginx-admission</span>
      <span class="na">nodeSelector</span><span class="pi">:</span>
        <span class="na">kubernetes.io/os</span><span class="pi">:</span> <span class="s">linux</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">2000</span>
</code></pre></div></div> <p>배포는 아래의 명령어로 진행합니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span>  nginx-ingress.yaml
</code></pre></div></div> <h2 id="테스트-서비스-생성">테스트 서비스 생성</h2> <p>테스트 서비스는 스터디 6주차에 테스트 했던, svc1,2,3를 이용할 예정입니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 생성</span>
<span class="nv">$ </span>curl <span class="nt">-s</span> <span class="nt">-O</span> https://raw.githubusercontent.com/gasida/NDKS/main/7/svc1-pod.yaml
<span class="nv">$ </span>curl <span class="nt">-s</span> <span class="nt">-O</span> https://raw.githubusercontent.com/gasida/NDKS/main/7/svc2-pod.yaml
<span class="nv">$ </span>curl <span class="nt">-s</span> <span class="nt">-O</span> https://raw.githubusercontent.com/gasida/NDKS/main/7/svc3-pod.yaml
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> svc1-pod.yaml,svc2-pod.yaml,svc3-pod.yaml
</code></pre></div></div> <h2 id="인그레스정책-생성">인그레스(정책) 생성</h2> <p>설치된 ingress의 정책을 설정합니다. 503 error 발생을 위해서 실제로 배포되지 않은 서비스를 등록 합니다.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">cat &lt;&lt;EOT&gt; ingress1.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-1</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="c1">#nginx.ingress.kubernetes.io/upstream-hash-by: "true"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ingressClassName</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">http</span><span class="pi">:</span>
      <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
        <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
        <span class="na">backend</span><span class="pi">:</span>
          <span class="na">service</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">svc1-web</span>
            <span class="na">port</span><span class="pi">:</span>
              <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/guest</span>
        <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
        <span class="na">backend</span><span class="pi">:</span>
          <span class="na">service</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">svc2-guest</span>
            <span class="na">port</span><span class="pi">:</span>
              <span class="na">number</span><span class="pi">:</span> <span class="m">8080</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/admin</span>
        <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
        <span class="na">backend</span><span class="pi">:</span>
          <span class="na">service</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">svc3-admin</span>
            <span class="na">port</span><span class="pi">:</span>
              <span class="na">number</span><span class="pi">:</span> <span class="m">8080</span>
      <span class="c1"># 503 에러를 발생시키키 위해서 없는 서비스 등록</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/error</span>
        <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
        <span class="na">backend</span><span class="pi">:</span>
          <span class="na">service</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">error</span>
            <span class="na">port</span><span class="pi">:</span>
              <span class="na">number</span><span class="pi">:</span> <span class="m">8080</span>
<span class="s">EOT</span>
</code></pre></div></div> <p>배포는 아래의 명령어로 진행합니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span>  ingress1.yaml
</code></pre></div></div> <h2 id="200-400-503-error-테스트">200, 400, 503 Error 테스트</h2> <blockquote> <p>svc1~3 까지 접속 테스트를 해보고, 404, 503 Error 페이지를 확인 합니다.</p> </blockquote> <h3 id="설치된-ingress-정보-확인">설치된 ingress 정보 확인</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 인그레스 관련된 정보 확인 : 포드(Nginx 서버), 서비스 타입 확인</span>
<span class="nv">$ </span>kubectl get pod,svc <span class="nt">-n</span> ingress-nginx <span class="nt">-l</span> app.kubernetes.io/component<span class="o">=</span>controller
NAME                                            READY   STATUS    RESTARTS   AGE
pod/ingress-nginx-controller-776fccd998-b9726   1/1     Running   0          44m

NAME                                         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                      AGE
service/ingress-nginx-controller             NodePort    10.105.0.111    &lt;none&gt;        80:32050/TCP,443:32767/TCP   3h13m
service/ingress-nginx-controller-admission   ClusterIP   10.100.204.47   &lt;none&gt;        443/TCP                      3h13m

<span class="c"># ingress-nginx-controller NodePort(HTTP 접속용) 변수 지정 및 포트 확인</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">IngHttp</span><span class="o">=</span><span class="si">$(</span>kubectl get service <span class="nt">-n</span> ingress-nginx ingress-nginx-controller <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.ports[0].nodePort}'</span><span class="si">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$IngHttp</span>
32050
<span class="c"># main 노드의 IP 확인</span>
<span class="nv">$ </span>ip addr | <span class="nb">grep </span>enp0s8
3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    inet 192.168.10.10/24 brd 192.168.10.255 scope global enp0s8
</code></pre></div></div> <h3 id="svc1-확인">svc1 확인</h3> <p><img src="/assets/img/post_img/kang_last_svc1.png" alt="" /></p> <h3 id="svc2-확인">svc2 확인</h3> <p><img src="/assets/img/post_img/kang_last_svc2.png" alt="" /></p> <h3 id="svc3-확인">svc3 확인</h3> <p><img src="/assets/img/post_img/kang_last_svc3.png" alt="" /></p> <h3 id="404-error-확인">404 Error 확인</h3> <blockquote> <p>정의 되지 않은 /hello 를 호출해서 404 Error 발생</p> </blockquote> <p><img src="/assets/img/post_img/kang_last_404.png" alt="" /></p> <h3 id="503-error-확인">503 Error 확인</h3> <blockquote> <p>제공되지 않는 서비스인 /error 를 호출해서 503 Error 발생</p> </blockquote> <p><img src="/assets/img/post_img/kang_last_503.png" alt="" /></p> <h2 id="마치며">마치며</h2> <p>전체 여정은 아래와 같습니다.</p> <div class="mermaid"> graph TD; A[백엔드 서비스 생성] --&gt;|기본 서비스 &amp; custom error 설정| B(Ingress 생성); B --&gt; C(운영 서비스 생성); C --&gt; D(인그레스 정책 생성); D --&gt; E[테스트]; </div> <p>작업을 하면서, 인그레스에 대해서 많이 배우게 되었네요.</p> <h2 id="참고자료">참고자료</h2> <ul> <li><a href="https://kubernetes.github.io/ingress-nginx/examples/customization/custom-errors/">Custom Errors</a></li> <li><a href="https://dev.to/kenmoini/custom-kubernetes-ingress-default-backend-and-error-pages-3alh">Custom Kubernetes Ingress Default Backend and Error Pages</a></li> <li><a href="https://github.com/kenmoini/custom-nginx-ingress-errors">kenmoini/custom-nginx-ingress-errors</a></li> </ul> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://lahuman.github.io/tags/#kang" title="Pages tagged kang" class="tag"><span class="term">kang</span></a><a href="https://lahuman.github.io/tags/#ingress" title="Pages tagged ingress" class="tag"><span class="term">ingress</span></a><a href="https://lahuman.github.io/tags/#errorpage" title="Pages tagged errorpage" class="tag"><span class="term">errorpage</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://lahuman.github.io/kang_last_mission/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://lahuman.github.io/kang_last_mission/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://lahuman.github.io/kang_last_mission/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-ubp67fs9s850" data-ad-width = "320" data-ad-height = "100"></ins> <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://lahuman.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://lahuman.github.io/assets/js/scripts.js"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74095083-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-74095083-1'); </script> <script type="text/javascript"> var disqus_shortname = 'daniels-blog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
