<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>AWS의 CodePipeline 에서 SonarQube 사용하기 &#8211; lahuman</title> <meta name="description" content="열심히 사는 아저씨"> <meta name="keywords" content="nodejs, eventloop"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://lahuman.github.io/assets/img/logo.png"> <meta name="twitter:title" content="AWS의 CodePipeline 에서 SonarQube 사용하기"> <meta name="twitter:description" content="정적 코드 분석을 해보아요!"> <!-- Open Graph --> <meta property="og:locale" content="ko_KR"> <meta property="og:type" content="article"> <meta property="og:title" content="AWS의 CodePipeline 에서 SonarQube 사용하기"> <meta property="og:description" content="정적 코드 분석을 해보아요!"> <meta property="og:url" content="https://lahuman.github.io/aws_snoarqube/"> <meta property="og:site_name" content="lahuman"> <meta property="og:image" content="https://lahuman.github.io/assets/img/logo.png"> <link rel="canonical" href="https://lahuman.github.io/aws_snoarqube/"> <link href="https://lahuman.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="lahuman Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://lahuman.github.io/assets/css/main.css"> <!-- JS --> <script src="https://lahuman.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://lahuman.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://lahuman.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://lahuman.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://lahuman.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://lahuman.github.io/favicon.png" /> <link rel="shortcut icon" href="https://lahuman.github.io/favicon.ico" /> <!-- mermaid --> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script>mermaid.initialize({startOnLoad:true});</script> <!-- Background Image --> <style type="text/css">body {background-image:url(https://lahuman.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://lahuman.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://lahuman.github.io/assets/img/logo.png" alt="lahuman photo" class="author-photo"> <h4>lahuman</h4> <p>열심히 사는 아저씨</p> </li> <li><a href="https://lahuman.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://facebook.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://linkedin.com/in/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://lahuman.github.io/posts/">All Posts</a></li> <li><a href="https://lahuman.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://lahuman.github.io/projects/" >Projects</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>AWS의 CodePipeline 에서 SonarQube 사용하기</h1> <h4>02 Jan 2023</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~3 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://lahuman.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h1 id="aws의-code-pipline-에서-sonarqube-사용하기">AWS의 Code pipline 에서 SonarQube 사용하기</h1> <blockquote> <p>SonarQube는 20개 이상의 프로그래밍 언어에서 버그, 코드 스멜, 보안 취약점을 발견할 목적으로 정적 코드 분석으로 자동 리뷰를 수행하기 위한 지속적인 코드 품질 검사용 오픈 소스 플랫폼입니다. 또한 중복 코드, 코딩 표준, 유닛 테스트, 코드 커버리지, 코드 복잡도, 주석, 버그 및 보안 취약점의 보고서를 제공합니다. <a href="https://ko.wikipedia.org/wiki/%EC%86%8C%EB%82%98%ED%81%90%EB%B8%8C">wiki</a></p> </blockquote> <h2 id="설치-준비">설치 준비</h2> <p>설치하는 방식은 쉽게 Docker Image를 이용하는 방식과 Ec2에 설치하는 방식이 있습니다. 이번 글에서는 간단하게 Ec2에 설치하는 방식으로 진행합니다.</p> <h3 id="필요-소프트웨어">필요 소프트웨어</h3> <ul> <li>JDK 11 또는 JRE 11 이상</li> <li>DBMS(Options) <ul> <li>PostgreSQL 11 이상</li> <li>Oracle 12C 이상</li> </ul> </li> <li>Web browser(Client) <ul> <li>Microsoft Edge</li> <li>Mozilla Firefox</li> <li>Google Chrome</li> <li>Safari</li> </ul> </li> </ul> <h3 id="hardware-권장-사양">Hardware 권장 사양</h3> <ul> <li>1 core 이상의 CPU</li> <li>최소 3G 이상의 메모리</li> </ul> <h2 id="설치-하기">설치 하기</h2> <blockquote> <p>AWS Ec2가 준비 되어 있다는 전제 하에, DBMS를 제외하고 설치를 진행합니다.</p> </blockquote> <h3 id="1-업데이트--필요-패키지-설치">1. 업데이트 &amp; 필요 패키지 설치</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>yum update <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install </span>wget unzip <span class="nt">-y</span>
</code></pre></div></div> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># file &amp; memory update current session</span>
<span class="nv">$ </span><span class="nb">sudo </span>sysctl <span class="nt">-w</span> vm.max_map_count<span class="o">=</span>524288
<span class="nv">$ </span><span class="nb">sudo </span>sysctl <span class="nt">-w</span> fs.file-max<span class="o">=</span>131072
<span class="nv">$ </span><span class="nb">sudo ulimit</span> <span class="nt">-n</span> 131072
<span class="nv">$ </span><span class="nb">sudo ulimit</span> <span class="nt">-u</span> 8192
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">/etc/security/limits.conf</code> 파일을 아래와 같이 수정해 두면 서버가 재부팅이 되어서 반영 됩니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"account-name"</span>   -   nofile   131072
<span class="s2">"account-name"</span>   -   <span class="nb">nproc    </span>8192
</code></pre></div></div> <h3 id="2-jdk-11-설치">2. JDK 11 설치</h3> <blockquote> <p>open jdk 11을 설치 합니다.</p> </blockquote> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>amazon-linux-extras <span class="nb">install </span>java-openjdk11

<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install </span>java-11-openjdk-devel <span class="nt">-y</span>
</code></pre></div></div> <p>또는 실행파일을 받아서 설치 할 수 있습니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-O</span> https://download.java.net/java/GA/jdk11/13/GPL/openjdk-11.0.1_linux-x64_bin.tar.gz
<span class="nv">$ </span><span class="nb">tar </span>zxvf openjdk-11.0.1_linux-x64_bin.tar.gz
<span class="nv">$ </span><span class="nb">sudo chmod</span> <span class="nt">-R</span> 755 /usr/local/jdk-11.0.1
<span class="c"># 이 부분은 .bashrc 에 추가 해도 됩니다. </span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/local/jdk-11.0.1
<span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$JAVA_HOME</span>/bin:<span class="nv">$PATH</span>
</code></pre></div></div> <h3 id="3-sonarqube-설치">3. SonarQube 설치</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 작업 디렉터리로 이동</span>
<span class="nv">$ </span><span class="nb">cd</span> /applications
<span class="c"># 9.8 버젼으로 설치 진행</span>
<span class="nv">$ </span>wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.8.0.63668.zip

<span class="nv">$ </span>unzip sonarqube-9.8.0.63668.zip
</code></pre></div></div> <h3 id="4-sonarqube-실행">4. SonarQube 실행</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OS 에 알맞은 실행 위치로 이동</span>
<span class="nv">$ </span><span class="nb">cd</span> /applications/sonarqube-9.8.0.63668/bin/linux-x86-64
<span class="c"># 명령어 확인</span>
<span class="nv">$ </span>./sonar.sh
/usr/local/jdk-11.0.1/bin/java
Usage: ./sonar.sh <span class="o">{</span> console | start | stop | force-stop | restart | status | dump <span class="o">}</span>
<span class="c"># 실행</span>
<span class="nv">$ </span>./sonar.sh start
</code></pre></div></div> <h3 id="5-9000-포트-열기">5. 9000 포트 열기</h3> <p>기본 포트는 <code class="language-plaintext highlighter-rouge">9000</code>으로 해당 포트를 열고 <code class="language-plaintext highlighter-rouge">web browser</code>로 접근하면 됩니다.</p> <h2 id="sonarqube-연동-하기">SonarQube 연동 하기</h2> <h3 id="1-로그인">1. 로그인</h3> <p><img src="/assets/img/post_img/sonarqube-login.png" alt="" /></p> <p>로그인 초기 ID / PW는 <code class="language-plaintext highlighter-rouge">admin</code>/<code class="language-plaintext highlighter-rouge">admin</code> 입니다.</p> <p>로그인을 하면 초기 비밀번호를 변경하라고 가이드 합니다.</p> <h3 id="2-프로젝트-생성">2. 프로젝트 생성</h3> <p><code class="language-plaintext highlighter-rouge">Manually</code> 추가 선택</p> <p><img src="/assets/img/post_img/sonarqube-create-project.png" alt="" /></p> <p>내용 입력 후 저장 하면, 프로젝트 생성이 완료 됩니다.</p> <h3 id="3-프로젝트-설정">3. 프로젝트 설정</h3> <p><code class="language-plaintext highlighter-rouge">Locally</code> 를 선택하고</p> <p><img src="/assets/img/post_img/sonarqube-locally.png" alt="" /></p> <p>토큰 생성 합니다.</p> <p><img src="/assets/img/post_img/sonarqube-gen_token.png" alt="" /></p> <p>분석하려는 언어 와 환경을 선택합니다.</p> <p><img src="/assets/img/post_img/sonarqube-run-analysis.png" alt="" /></p> <p>아래와 같은 sonar-scanner를 이용한 분석 처리 준비가 완료 되었습니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>sonar-scanner <span class="se">\ </span>
  <span class="nt">-Dsonar</span>.projectKey<span class="o">=</span>doc4sm <span class="se">\ </span><span class="c"># project 이름</span>
  <span class="nt">-Dsonar</span>.sources<span class="o">=</span><span class="nb">.</span> <span class="se">\ </span><span class="c"># 분석 소스 위치</span>
  <span class="nt">-Dsonar</span>.host.url<span class="o">=</span>http://lahuman.github.io:9000 <span class="se">\ </span><span class="c"># host 주소</span>
  <span class="nt">-Dsonar</span>.login<span class="o">=</span>sqp_fasdfee85ujliuod4d38fa02b2d65f964726aca5 <span class="c"># 생성한 토큰 정보 </span>
</code></pre></div></div> <blockquote> <p><a href="https://docs.sonarqube.org/9.8/analyzing-source-code/scanners/sonarscanner/">sonarscanner</a> 는 여서 받을 수 있습니다.</p> </blockquote> <h3 id="4-프로젝트-분석-결과">4. 프로젝트 분석 결과</h3> <blockquote> <p><a href="https://docs.sonarqube.org/9.8/analyzing-source-code/scanners/sonarscanner/">sonarscanner</a> 를 이용해서 분석을 진행하면, 아래와 같은 결과를 확인 할 수 있습니다.</p> </blockquote> <p><img src="/assets/img/post_img/sonarqube-result.png" alt="" /></p> <h2 id="aws-codepipeline-과-연동하기">AWS CodePipeline 과 연동하기</h2> <blockquote> <p>AWS CodePipeline 이 이미 존재하고, 여기에 Code-review를 추가하는 방식으로 연동 합니다.</p> </blockquote> <h3 id="1-codecommit--pipeline--상세-이동-후-edit-add-stage-버튼을-클릭">1. CodeCommit =&gt; Pipeline =&gt; 상세 이동 후 Edit add Stage 버튼을 클릭</h3> <p><img src="/assets/img/post_img/aws-codepipeline-addstage.png" alt="" /></p> <h3 id="2-add-action-버튼-클릭-후-알맞은-값-설정">2. Add Action 버튼 클릭 후 알맞은 값 설정</h3> <p><img src="/assets/img/post_img/aws-codepipeline-addaction.png" alt="" /></p> <h3 id="3-create-build-project-버튼-클릭-후-build-project-설정">3. Create Build Project 버튼 클릭 후 build project 설정</h3> <p><img src="/assets/img/post_img/aws-codepipeline-create-build-project-1.png" alt="" /></p> <p><img src="/assets/img/post_img/aws-codepipeline-create-build-project-2.png" alt="" /></p> <p><img src="/assets/img/post_img/aws-codepipeline-create-build-project-3.png" alt="" /></p> <p><code class="language-plaintext highlighter-rouge">import build commands</code>는 아래와 같습니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: 0.2
<span class="nb">env</span>:
  shell: bash
phases:
  pre_build:
    commands:
      - <span class="nb">mkdir</span> /downloads/sonarqube <span class="nt">-p</span>
      - <span class="nb">cd</span> /downloads/sonarqube
      - wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.7.0.2747-linux.zip
      - unzip sonar-scanner-cli-4.7.0.2747-linux.zip
      - <span class="nb">mv </span>sonar-scanner-4.7.0.2747-linux /opt/sonar-scanner
      - <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"sonar.host.url=http://lahuman.github.io:9000/ </span><span class="se">\n</span><span class="s2">  sonar.sourceEncoding=UTF-8 </span><span class="se">\n</span><span class="s2"> sonar.qualitygate.wait=true "</span> <span class="o">&gt;&gt;</span> /opt/sonar-scanner/conf/sonar-scanner.properties
      - <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"#/bin/bash </span><span class="se">\n</span><span class="s2"> export PATH='</span><span class="nv">$PATH</span><span class="s2">:/opt/sonar-scanner/bin'"</span> <span class="o">&gt;&gt;</span> /etc/profile.d/sonar-scanner.sh
      - <span class="nb">source</span> /etc/profile.d/sonar-scanner.sh
      - sonar-scanner <span class="nt">-v</span>
  build:
    commands:
      - <span class="nb">cd</span> ../..
      - <span class="nb">cd</span> /codebuild/output/src<span class="k">*</span>/src
      - sonar-scanner <span class="nt">-Dsonar</span>.projectKey<span class="o">=</span>Example <span class="nt">-Dsonar</span>.sources<span class="o">=</span><span class="nb">.</span> <span class="nt">-Dsonar</span>.host.url<span class="o">=</span>http://lahuman.github.io:9000  <span class="nt">-Dsonar</span>.login<span class="o">=</span>sqp_017f2d65fa3rr34wesfd22369d98155fd4d493
</code></pre></div></div> <h3 id="4-설정-완료--저장">4. 설정 완료 &amp; 저장</h3> <p><img src="/assets/img/post_img/aws-codepipeline-addaction-createproject.png" alt="" /></p> <p>모든 설정이 완료 되었다면, 저장 버튼을 클릭합니다.</p> <h3 id="5-pipeline-실행">5. pipeline 실행</h3> <p><img src="/assets/img/post_img/aws-codepipeline-done.png" alt="" /></p> <p>전체 내용은 <a href="https://awstip.com/installing-sonarqube-on-aws-ec2-instance-and-integrating-it-with-aws-codepipeline-abec99416ba4">Installing SonarQube on AWS EC2 instance and Integrating it with AWS CodePipeline</a>를 참조해서 작성했습니다.</p> <h1 id="참고-자료">참고 자료</h1> <ul> <li><a href="https://awstip.com/installing-sonarqube-on-aws-ec2-instance-and-integrating-it-with-aws-codepipeline-abec99416ba4">Installing SonarQube on AWS EC2 instance and Integrating it with AWS CodePipeline</a></li> <li><a href="https://docs.sonarqube.org/latest/setup-and-upgrade/install-the-server/">Install the server</a></li> </ul> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://lahuman.github.io/tags/#nodejs" title="Pages tagged nodejs" class="tag"><span class="term">nodejs</span></a><a href="https://lahuman.github.io/tags/#eventloop" title="Pages tagged eventloop" class="tag"><span class="term">eventloop</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://lahuman.github.io/aws_snoarqube/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://lahuman.github.io/aws_snoarqube/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://lahuman.github.io/aws_snoarqube/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-ubp67fs9s850" data-ad-width = "320" data-ad-height = "100"></ins> <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://lahuman.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://lahuman.github.io/assets/js/scripts.js"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74095083-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-74095083-1'); </script> <script type="text/javascript"> var disqus_shortname = 'daniels-blog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
