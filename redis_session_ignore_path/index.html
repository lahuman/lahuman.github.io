<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Spring Session에서 특정 API에 대해 세션 생성 방지하기 &#8211; lahuman</title> <meta name="description" content="열심히 사는 아저씨"> <meta name="keywords" content="session, redis, spring"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://lahuman.github.io/assets/img/logo.png"> <meta name="twitter:title" content="Spring Session에서 특정 API에 대해 세션 생성 방지하기"> <meta name="twitter:description" content="request.session 사용을 주의 하세요!"> <!-- Open Graph --> <meta property="og:locale" content="ko_KR"> <meta property="og:type" content="article"> <meta property="og:title" content="Spring Session에서 특정 API에 대해 세션 생성 방지하기"> <meta property="og:description" content="request.session 사용을 주의 하세요!"> <meta property="og:url" content="https://lahuman.github.io/redis_session_ignore_path/"> <meta property="og:site_name" content="lahuman"> <meta property="og:image" content="https://lahuman.github.io/assets/img/logo.png"> <link rel="canonical" href="https://lahuman.github.io/redis_session_ignore_path/"> <link href="https://lahuman.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="lahuman Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://lahuman.github.io/assets/css/main.css"> <!-- JS --> <script src="https://lahuman.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://lahuman.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://lahuman.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://lahuman.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://lahuman.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://lahuman.github.io/favicon.png" /> <link rel="shortcut icon" href="https://lahuman.github.io/favicon.ico" /> <!-- mermaid --> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script>mermaid.initialize({startOnLoad:true});</script> <!-- Background Image --> <style type="text/css">body {background-image:url(https://lahuman.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://lahuman.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://lahuman.github.io/assets/img/logo.png" alt="lahuman photo" class="author-photo"> <h4>lahuman</h4> <p>열심히 사는 아저씨</p> </li> <li><a href="https://lahuman.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://facebook.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://linkedin.com/in/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/lahuman" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://lahuman.github.io/posts/">All Posts</a></li> <li><a href="https://lahuman.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://lahuman.github.io/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Spring Session에서 특정 API에 대해 세션 생성 방지하기</h1> <h4>26 Sep 2024</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~2 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://lahuman.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h1 id="spring-session에서-특정-api에-대해-세션-생성-방지하기">Spring Session에서 특정 API에 대해 세션 생성 방지하기</h1> <p>Spring 애플리케이션에서 <code class="highlighter-rouge">/health</code> 같은 특정 API 호출 시 불필요한 세션이 생성되지 않도록 하기 위한 방법을 정리합니다. 주로 <code class="highlighter-rouge">SessionRepositoryFilter</code> 커스터마이징과 필터 추가를 통해 이를 해결할 수 있습니다.</p> <h2 id="1-문제-상황">1. 문제 상황</h2> <p>기본적으로 Spring은 요청이 들어올 때 세션을 자동으로 생성합니다. 그러나 <code class="highlighter-rouge">/health</code>와 같은 단순 API에 대해 세션 생성이 불필요할 수 있습니다. 특정 URL에 대해 세션 생성을 방지하고 싶다면, 이를 명시적으로 처리해야 합니다.</p> <h2 id="2-커스텀-sessionrepositoryfilter-생성">2. 커스텀 <code class="highlighter-rouge">SessionRepositoryFilter</code> 생성</h2> <p><code class="highlighter-rouge">SessionRepositoryFilter</code>를 확장하여, 특정 URL에 대해 세션이 생성되지 않도록 하는 필터를 작성할 수 있습니다.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.springframework.session.Session</span>
<span class="k">import</span> <span class="nn">org.springframework.session.SessionRepository</span>
<span class="k">import</span> <span class="nn">org.springframework.session.web.http.SessionRepositoryFilter</span>
<span class="k">import</span> <span class="nn">javax.servlet.FilterChain</span>
<span class="k">import</span> <span class="nn">javax.servlet.ServletException</span>
<span class="k">import</span> <span class="nn">javax.servlet.ServletRequest</span>
<span class="k">import</span> <span class="nn">javax.servlet.ServletResponse</span>
<span class="k">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span>

<span class="kd">class</span> <span class="nc">CustomSessionRepositoryFilter</span><span class="p">&lt;</span><span class="n">S</span> <span class="p">:</span> <span class="n">Session</span><span class="p">&gt;(</span>
    <span class="n">sessionRepository</span><span class="p">:</span> <span class="n">SessionRepository</span><span class="p">&lt;</span><span class="n">S</span><span class="p">&gt;,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">excludedUrls</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">"/health"</span><span class="p">,</span> <span class="s">"/actuator"</span><span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">SessionRepositoryFilter</span><span class="p">&lt;</span><span class="n">S</span><span class="p">&gt;(</span><span class="n">sessionRepository</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">@Throws</span><span class="p">(</span><span class="n">ServletException</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">doFilterInternal</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">ServletRequest</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">ServletResponse</span><span class="p">,</span> <span class="n">chain</span><span class="p">:</span> <span class="n">FilterChain</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">httpRequest</span> <span class="p">=</span> <span class="n">request</span> <span class="k">as</span> <span class="n">HttpServletRequest</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">httpRequest</span><span class="p">.</span><span class="n">requestURI</span>

        <span class="c1">// 제외할 URL에 대해 세션 생성하지 않음
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">excludedUrls</span><span class="p">.</span><span class="n">any</span> <span class="p">{</span> <span class="n">path</span><span class="p">.</span><span class="n">startsWith</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>
            <span class="n">chain</span><span class="p">.</span><span class="n">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">.</span><span class="n">doFilterInternal</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">chain</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>위의 코드는 <code class="highlighter-rouge">/health</code>나 <code class="highlighter-rouge">/actuator</code> 경로로 들어오는 요청에 대해 세션을 생성하지 않도록 설정합니다.</p> <h2 id="3-필터를-spring-bean으로-등록">3. 필터를 Spring Bean으로 등록</h2> <p>필터를 빈으로 등록하여 특정 URL에 대한 요청에만 적용되도록 합니다.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.springframework.boot.web.servlet.FilterRegistrationBean</span>
<span class="k">import</span> <span class="nn">org.springframework.context.annotation.Bean</span>
<span class="k">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span>
<span class="k">import</span> <span class="nn">org.springframework.core.Ordered</span>
<span class="k">import</span> <span class="nn">org.springframework.session.Session</span>
<span class="k">import</span> <span class="nn">org.springframework.session.SessionRepository</span>
<span class="k">import</span> <span class="nn">org.springframework.session.web.http.SessionRepositoryFilter</span>

<span class="n">@Configuration</span>
<span class="kd">class</span> <span class="nc">SessionFilterConfig</span> <span class="p">{</span>

    <span class="n">@Bean</span>
    <span class="k">fun</span> <span class="nf">sessionFilter</span><span class="p">(</span><span class="n">sessionRepository</span><span class="p">:</span> <span class="n">SessionRepository</span><span class="p">&lt;*&gt;):</span> <span class="n">FilterRegistrationBean</span><span class="p">&lt;</span><span class="n">SessionRepositoryFilter</span><span class="p">&lt;*&gt;&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">filter</span> <span class="p">=</span> <span class="n">CustomSessionRepositoryFilter</span><span class="p">(</span><span class="n">sessionRepository</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">registration</span> <span class="p">=</span> <span class="n">FilterRegistrationBean</span><span class="p">&lt;</span><span class="n">SessionRepositoryFilter</span><span class="p">&lt;*&gt;&gt;()</span>
        <span class="n">registration</span><span class="p">.</span><span class="n">filter</span> <span class="p">=</span> <span class="n">filter</span>
        <span class="n">registration</span><span class="p">.</span><span class="n">order</span> <span class="p">=</span> <span class="n">Ordered</span><span class="p">.</span><span class="n">HIGHEST_PRECEDENCE</span>
        <span class="n">registration</span><span class="p">.</span><span class="n">addUrlPatterns</span><span class="p">(</span><span class="s">"/*"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">registration</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="4-세션-생성-여부-확인">4. 세션 생성 여부 확인</h2> <h3 id="일반적으로-사용하는-requestsession-을-사용할-경우-getsession이-호출되어-세션이-없을-경우-새로-생성하게-됩니다">일반적으로 사용하는 request.session 을 사용할 경우 getSession()이 호출되어 세션이 없을 경우 새로 생성하게 됩니다.</h3> <p>세션이 실제로 생성되었는지 여부를 확인하려면, <code class="highlighter-rouge">HttpServletRequest.getSession(false)</code>를 사용하여 세션이 존재하는지 확인할 수 있습니다.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span>
<span class="k">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span>
<span class="k">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span>
<span class="k">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span>

<span class="n">@RestController</span>
<span class="n">@RequestMapping</span><span class="p">(</span><span class="s">"/session-test"</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">SessionController</span> <span class="p">{</span>

    <span class="n">@GetMapping</span><span class="p">(</span><span class="s">"/check"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">checkSession</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">HttpServletRequest</span><span class="p">):</span> <span class="n">String</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">session</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">getSession</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>  <span class="c1">// 세션이 없으면 새로 생성하지 않음
</span>        <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">session</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="s">"Session not created"</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">"Session exists: ${session.id}"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>이 코드는 <code class="highlighter-rouge">/session-test/check</code>로 요청 시, 세션이 이미 존재하는지 여부를 확인해줍니다.</p> <h2 id="5-결론">5. 결론</h2> <p>Spring 애플리케이션에서 <code class="highlighter-rouge">/health</code>와 같은 경로에 대한 세션 생성을 방지하기 위해서는 필터를 적절히 구성하고, 필요에 따라 Spring Security 설정을 통해 세션 생성을 제어할 수 있습니다. 이 방법을 통해 불필요한 세션 생성을 막아 애플리케이션의 성능을 향상시킬 수 있습니다.</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://lahuman.github.io/tags/#session" title="Pages tagged session" class="tag"><span class="term">session</span></a><a href="https://lahuman.github.io/tags/#redis" title="Pages tagged redis" class="tag"><span class="term">redis</span></a><a href="https://lahuman.github.io/tags/#spring" title="Pages tagged spring" class="tag"><span class="term">spring</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://lahuman.github.io/redis_session_ignore_path/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://lahuman.github.io/redis_session_ignore_path/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://lahuman.github.io/redis_session_ignore_path/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> <ins class="kakao_ad_area" style="display:none;" data-ad-unit="DAN-ubp67fs9s850" data-ad-width="320" data-ad-height="100"></ins> <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://lahuman.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://lahuman.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://lahuman.github.io/assets/js/scripts.js"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74095083-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-74095083-1'); </script> <script type="text/javascript"> var disqus_shortname = 'daniels-blog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
